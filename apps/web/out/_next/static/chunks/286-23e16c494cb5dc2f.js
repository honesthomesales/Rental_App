"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[286],{138:function(e,t,a){Object.defineProperty(t,"__esModule",{value:!0}),t.supabase=void 0,t.getSupabaseClient=o,t.resetSupabaseClient=function(){i&&(i=null),l=!1},t.handleSupabaseError=function(e){return(null==e?void 0:e.message)?e.message:(null==e?void 0:e.error_description)?e.error_description:"An unexpected error occurred"},t.createApiResponse=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return{data:e,error:t,success:!t}};let r=a(3334),n="https://gnisgfojzrrnidizrycj.supabase.co",s="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImduaXNnZm9qenJybmlkaXpyeWNqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTE3NjgyMDMsImV4cCI6MjA2NzM0NDIwM30.jLRIt4mqNa-6rnWudT_ciCvfPC0i0WlWFrCgC7NbhYM",i=null,l=!1;function o(){if(i)return i;if(l)throw Error("Supabase client is already being initialized");try{return l=!0,i=function(){if(!n||!s)throw Error("Missing Supabase environment variables for React Native.");return(0,r.createClient)(n,s,{auth:{autoRefreshToken:!1,persistSession:!1,detectSessionInUrl:!1,storageKey:"rental-app-rn-auth"},global:{headers:{"X-Client-Info":"rental-app-rn"}}})}()}finally{l=!1}}t.supabase=o()},321:function(e,t,a){Object.defineProperty(t,"__esModule",{value:!0}),t.supabase=void 0,t.getSupabaseClient=o,t.resetSupabaseClient=function(){i&&(i=null),l=!1},t.handleSupabaseError=function(e){return(null==e?void 0:e.message)?e.message:(null==e?void 0:e.error_description)?e.error_description:"An unexpected error occurred"},t.createApiResponse=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return{data:e,error:t,success:!t}};let r=a(3334),n="https://gnisgfojzrrnidizrycj.supabase.co",s="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImduaXNnZm9qenJybmlkaXpyeWNqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTE3NjgyMDMsImV4cCI6MjA2NzM0NDIwM30.jLRIt4mqNa-6rnWudT_ciCvfPC0i0WlWFrCgC7NbhYM",i=null,l=!1;function o(){if(i)return i;if(l)throw Error("Supabase client is already being initialized");try{return l=!0,i=function(){if(!n||!s)throw Error("Supabase configuration is missing. Please check your environment variables.");return(0,r.createClient)(n,s,{auth:{autoRefreshToken:!1,persistSession:!1,detectSessionInUrl:!1,storageKey:"rental-app-auth"},global:{headers:{"X-Client-Info":"rental-app-web"}}})}()}finally{l=!1}}t.supabase=(()=>{try{return o()}catch(e){return console.error("Failed to get Supabase client:",e),null}})()},2356:function(e,t){Object.defineProperty(t,"__esModule",{value:!0})},6286:function(e,t,a){var r=Object.create?function(e,t,a,r){void 0===r&&(r=a);var n=Object.getOwnPropertyDescriptor(t,a);(!n||("get"in n?!t.__esModule:n.writable||n.configurable))&&(n={enumerable:!0,get:function(){return t[a]}}),Object.defineProperty(e,r,n)}:function(e,t,a,r){void 0===r&&(r=a),e[r]=t[a]},n=function(e,t){for(var a in e)"default"===a||Object.prototype.hasOwnProperty.call(t,a)||r(t,e,a)};Object.defineProperty(t,"__esModule",{value:!0}),t.OtherService=t.RentPeriodsService=t.PaymentsService=t.TransactionsService=t.LeasesService=t.TenantsService=t.PropertiesService=t.createApiResponseRN=t.handleSupabaseErrorRN=t.supabaseRN=t.createApiResponse=t.handleSupabaseError=t.supabase=void 0,n(a(2287),t),n(a(2356),t),n(a(4253),t);var s=a(321);Object.defineProperty(t,"supabase",{enumerable:!0,get:function(){return s.supabase}}),Object.defineProperty(t,"handleSupabaseError",{enumerable:!0,get:function(){return s.handleSupabaseError}}),Object.defineProperty(t,"createApiResponse",{enumerable:!0,get:function(){return s.createApiResponse}});var i=a(138);Object.defineProperty(t,"supabaseRN",{enumerable:!0,get:function(){return i.supabase}}),Object.defineProperty(t,"handleSupabaseErrorRN",{enumerable:!0,get:function(){return i.handleSupabaseError}}),Object.defineProperty(t,"createApiResponseRN",{enumerable:!0,get:function(){return i.createApiResponse}});var l=a(7162);Object.defineProperty(t,"PropertiesService",{enumerable:!0,get:function(){return l.PropertiesService}});var o=a(2446);Object.defineProperty(t,"TenantsService",{enumerable:!0,get:function(){return o.TenantsService}});var c=a(3964);Object.defineProperty(t,"LeasesService",{enumerable:!0,get:function(){return c.LeasesService}});var p=a(2160);Object.defineProperty(t,"TransactionsService",{enumerable:!0,get:function(){return p.TransactionsService}});var u=a(3137);Object.defineProperty(t,"PaymentsService",{enumerable:!0,get:function(){return u.PaymentsService}});var d=a(8762);Object.defineProperty(t,"RentPeriodsService",{enumerable:!0,get:function(){return d.RentPeriodsService}});var _=a(7539);Object.defineProperty(t,"OtherService",{enumerable:!0,get:function(){return _.OtherService}})},3964:function(e,t,a){Object.defineProperty(t,"__esModule",{value:!0}),t.LeasesService=void 0;let r=a(321);class n{static async getAll(){try{let e=(0,r.getSupabaseClient)(),{data:t,error:a}=await e.from("RENT_leases").select("*").order("lease_start_date",{ascending:!1});if(a)return(0,r.createApiResponse)(null,(0,r.handleSupabaseError)(a));return(0,r.createApiResponse)(t)}catch(e){return(0,r.createApiResponse)(null,(0,r.handleSupabaseError)(e))}}static async getByPropertyId(e){try{let t=(0,r.getSupabaseClient)(),{data:a,error:n}=await t.from("RENT_leases").select("*").eq("property_id",e).order("lease_start_date",{ascending:!1});if(n)return(0,r.createApiResponse)(null,(0,r.handleSupabaseError)(n));return(0,r.createApiResponse)(a)}catch(e){return(0,r.createApiResponse)(null,(0,r.handleSupabaseError)(e))}}static async getActiveLeasesByPropertyId(e){try{let t=(0,r.getSupabaseClient)(),a=new Date().toISOString().split("T")[0],{data:n,error:s}=await t.from("RENT_leases").select("*").eq("property_id",e).lte("lease_start_date",a).gte("lease_end_date",a).order("lease_start_date",{ascending:!1});if(s)return(0,r.createApiResponse)(null,(0,r.handleSupabaseError)(s));return(0,r.createApiResponse)(n)}catch(e){return(0,r.createApiResponse)(null,(0,r.handleSupabaseError)(e))}}static async hasActiveLeases(e){try{let t=await this.getActiveLeasesByPropertyId(e);if(!t.success)return(0,r.createApiResponse)(!1);let a=t.data&&t.data.length>0;return(0,r.createApiResponse)(a)}catch(e){return(0,r.createApiResponse)(!1)}}static async create(e){try{let t=(0,r.getSupabaseClient)(),{data:a,error:n}=await t.from("RENT_leases").insert([e]).select().single();if(n)return(0,r.createApiResponse)(null,(0,r.handleSupabaseError)(n));return(0,r.createApiResponse)(a)}catch(e){return(0,r.createApiResponse)(null,(0,r.handleSupabaseError)(e))}}static async update(e,t){try{let a=(0,r.getSupabaseClient)(),{data:n,error:s}=await a.from("RENT_leases").update(t).eq("id",e).select().single();if(s)return(0,r.createApiResponse)(null,(0,r.handleSupabaseError)(s));return(0,r.createApiResponse)(n)}catch(e){return(0,r.createApiResponse)(null,(0,r.handleSupabaseError)(e))}}static async delete(e){try{let t=(0,r.getSupabaseClient)(),{error:a}=await t.from("RENT_leases").delete().eq("id",e);if(a)return(0,r.createApiResponse)(null,(0,r.handleSupabaseError)(a));return(0,r.createApiResponse)(!0)}catch(e){return(0,r.createApiResponse)(null,(0,r.handleSupabaseError)(e))}}static async updateLeaseStatus(e){try{let t=(0,r.getSupabaseClient)(),a=new Date().toISOString().split("T")[0],{data:n,error:s}=await t.from("RENT_leases").select("*").eq("id",e).single();if(s)return(0,r.createApiResponse)(null,(0,r.handleSupabaseError)(s));let i="active";if(a<n.lease_start_date?i="pending":a>n.lease_end_date&&(i="expired"),n.status!==i)return await this.update(e,{status:i});return(0,r.createApiResponse)(n)}catch(e){return(0,r.createApiResponse)(null,(0,r.handleSupabaseError)(e))}}static async getAllPropertiesWithLeaseStatus(){try{let e=(0,r.getSupabaseClient)(),{data:t,error:a}=await e.from("RENT_leases").select("*").eq("status","active");if(a)return(0,r.createApiResponse)(null,(0,r.handleSupabaseError)(a));let n=new Map;(t||[]).forEach(e=>{n.has(e.property_id)||n.set(e.property_id,[]),n.get(e.property_id).push(e)});let{data:s,error:i}=await e.from("RENT_properties").select("id");if(i)return(0,r.createApiResponse)(null,(0,r.handleSupabaseError)(i));let l=(s||[]).map(e=>{let t=n.get(e.id)||[];return{property_id:e.id,has_active_lease:t.length>0,active_lease_count:t.length,active_leases:t}});return(0,r.createApiResponse)(l)}catch(e){return(0,r.createApiResponse)(null,(0,r.handleSupabaseError)(e))}}}t.LeasesService=n},7539:function(e,t,a){Object.defineProperty(t,"__esModule",{value:!0}),t.OtherService=void 0;let r=a(321);class n{static async getAll(){try{let e=(0,r.getSupabaseClient)(),{data:t,error:a}=await e.from("rent_other").select("*").order("date",{ascending:!1});if(a)return console.error("OtherService.getAll error:",a),(0,r.createApiResponse)(null,(0,r.handleSupabaseError)(a));return(0,r.createApiResponse)(t)}catch(e){return console.error("OtherService.getAll exception:",e),(0,r.createApiResponse)(null,(0,r.handleSupabaseError)(e))}}static async getByDateRange(e,t){try{let a=(0,r.getSupabaseClient)(),{data:n,error:s}=await a.from("rent_other").select("*").gte("date",e).lte("date",t).order("date",{ascending:!1});if(s)return console.error("OtherService.getByDateRange error:",s),(0,r.createApiResponse)(null,(0,r.handleSupabaseError)(s));return(0,r.createApiResponse)(n)}catch(e){return console.error("OtherService.getByDateRange exception:",e),(0,r.createApiResponse)(null,(0,r.handleSupabaseError)(e))}}static async create(e){try{let t=(0,r.getSupabaseClient)(),{data:a,error:n}=await t.from("rent_other").insert([e]).select().single();if(n)return console.error("OtherService.create error:",n),(0,r.createApiResponse)(null,(0,r.handleSupabaseError)(n));return(0,r.createApiResponse)(a)}catch(e){return console.error("OtherService.create exception:",e),(0,r.createApiResponse)(null,(0,r.handleSupabaseError)(e))}}static async update(e){try{let t=(0,r.getSupabaseClient)(),{id:a,...n}=e,{data:s,error:i}=await t.from("rent_other").update(n).eq("id",a).select().single();if(i)return console.error("OtherService.update error:",i),(0,r.createApiResponse)(null,(0,r.handleSupabaseError)(i));return(0,r.createApiResponse)(s)}catch(e){return console.error("OtherService.update exception:",e),(0,r.createApiResponse)(null,(0,r.handleSupabaseError)(e))}}static async delete(e){try{let t=(0,r.getSupabaseClient)(),{error:a}=await t.from("rent_other").delete().eq("id",e);if(a)return console.error("OtherService.delete error:",a),(0,r.createApiResponse)(null,(0,r.handleSupabaseError)(a));return(0,r.createApiResponse)(!0)}catch(e){return console.error("OtherService.delete exception:",e),(0,r.createApiResponse)(null,(0,r.handleSupabaseError)(e))}}}t.OtherService=n},3137:function(e,t,a){Object.defineProperty(t,"__esModule",{value:!0}),t.PaymentsService=void 0;let r=a(321);class n{static async getAll(){try{let e=(0,r.getSupabaseClient)(),{data:t,error:a}=await e.from("RENT_payments").select("*").order("created_at",{ascending:!1});if(a)return(0,r.createApiResponse)(null,(0,r.handleSupabaseError)(a));return(0,r.createApiResponse)(t)}catch(e){return(0,r.createApiResponse)(null,(0,r.handleSupabaseError)(e))}}static async getByDateRange(e,t){try{let a=(0,r.getSupabaseClient)(),{data:n,error:s}=await a.from("RENT_payments").select("*").gte("payment_date",e).lte("payment_date",t).order("payment_date",{ascending:!1});if(s)return(0,r.createApiResponse)(null,(0,r.handleSupabaseError)(s));return(0,r.createApiResponse)(n)}catch(e){return(0,r.createApiResponse)(null,(0,r.handleSupabaseError)(e))}}static async getMostRecentMonthWithPayments(){try{let e=(0,r.getSupabaseClient)(),{data:t,error:a}=await e.from("RENT_payments").select("payment_date").order("payment_date",{ascending:!1}).limit(1);if(a)return(0,r.createApiResponse)(null,(0,r.handleSupabaseError)(a));if(!t||0===t.length){let e=new Date;return(0,r.createApiResponse)({year:e.getFullYear(),month:e.getMonth()})}let n=t[0],s=new Date(n.payment_date);return(0,r.createApiResponse)({year:s.getFullYear(),month:s.getMonth()})}catch(e){return(0,r.createApiResponse)(null,(0,r.handleSupabaseError)(e))}}static async getPropertiesWithTenants(){try{let e=(0,r.getSupabaseClient)(),{data:t,error:a}=await e.from("RENT_properties").select("id, name, address, city, state, monthly_rent, notes").order("name");if(a)return(0,r.createApiResponse)(null,(0,r.handleSupabaseError)(a));let{data:n,error:s}=await e.from("RENT_tenants").select("id, first_name, last_name, property_id").eq("is_active",!0);if(s)return(0,r.createApiResponse)(null,(0,r.handleSupabaseError)(s));let{data:i,error:l}=await e.from("RENT_leases").select("id, tenant_id, rent_cadence, rent, lease_start_date, lease_end_date, status").eq("status","active");if(l)return(0,r.createApiResponse)(null,(0,r.handleSupabaseError)(l));let o=(t||[]).map(e=>{let t=(n||[]).filter(t=>t.property_id===e.id),a=(i||[]).filter(e=>t.some(t=>t.id===e.tenant_id));return{...e,tenants:t,leases:a}});return(0,r.createApiResponse)(o)}catch(e){return(0,r.createApiResponse)(null,(0,r.handleSupabaseError)(e))}}static async createPayment(e){try{let t=(0,r.getSupabaseClient)(),{data:a,error:n}=await t.from("RENT_payments").insert([{payment_date:e.payment_date,amount:e.amount,property_id:e.property_id,tenant_id:e.tenant_id,payment_type:e.payment_type,notes:e.notes}]).select().single();if(n)return(0,r.createApiResponse)(null,(0,r.handleSupabaseError)(n));return(0,r.createApiResponse)(a)}catch(e){return(0,r.createApiResponse)(null,(0,r.handleSupabaseError)(e))}}static async updatePayment(e,t){try{let a=(0,r.getSupabaseClient)(),{data:n,error:s}=await a.from("RENT_payments").update(t).eq("id",e).select().single();if(s)return(0,r.createApiResponse)(null,(0,r.handleSupabaseError)(s));return(0,r.createApiResponse)(n)}catch(e){return(0,r.createApiResponse)(null,(0,r.handleSupabaseError)(e))}}static async deletePayment(e){try{let t=(0,r.getSupabaseClient)(),{error:a}=await t.from("RENT_payments").delete().eq("id",e);if(a)return(0,r.createApiResponse)(null,(0,r.handleSupabaseError)(a));return(0,r.createApiResponse)(!0)}catch(e){return(0,r.createApiResponse)(null,(0,r.handleSupabaseError)(e))}}static async getByPropertyAndDateRange(e,t,a){try{let n=(0,r.getSupabaseClient)(),{data:s,error:i}=await n.from("RENT_payments").select("*").eq("property_id",e).gte("payment_date",t).lte("payment_date",a).order("payment_date",{ascending:!1});if(i)return(0,r.createApiResponse)(null,(0,r.handleSupabaseError)(i));return(0,r.createApiResponse)(s)}catch(e){return(0,r.createApiResponse)(null,(0,r.handleSupabaseError)(e))}}}t.PaymentsService=n},7162:function(e,t,a){Object.defineProperty(t,"__esModule",{value:!0}),t.PropertiesService=void 0;let r=a(321),n=a(3964);class s{static async getAll(e){try{let t=(0,r.getSupabaseClient)().from("RENT_properties").select("\n          id,\n          name,\n          address,\n          city,\n          state,\n          zip_code,\n          property_type,\n          status,\n          bedrooms,\n          bathrooms,\n          square_feet,\n          year_built,\n          purchase_price,\n          purchase_payment,\n          purchase_date,\n          current_value,\n          monthly_rent,\n          is_for_rent,\n          is_for_sale,\n          insurance_premium,\n          property_tax,\n          notes,\n          created_at,\n          updated_at\n        ").order("created_at",{ascending:!1});(null==e?void 0:e.is_for_rent)!==void 0&&(t=t.eq("is_for_rent",e.is_for_rent)),(null==e?void 0:e.is_for_sale)!==void 0&&(t=t.eq("is_for_sale",e.is_for_sale)),(null==e?void 0:e.city)&&(t=t.eq("city",e.city)),(null==e?void 0:e.state)&&(t=t.eq("state",e.state));let{data:a,error:s}=await t;if(s)return console.error("PropertiesService.getAll error:",s),(0,r.createApiResponse)(null,(0,r.handleSupabaseError)(s));let i=await n.LeasesService.getAllPropertiesWithLeaseStatus();if(!i.success||!i.data)return(0,r.createApiResponse)(a);let l=new Map(i.data.map(e=>[e.property_id,e])),o=a.map(e=>{let t=l.get(e.id),a=(null==t?void 0:t.has_active_lease)||!1;return{...e,status:a?"rented":"empty",active_leases:(null==t?void 0:t.active_leases)||[],active_lease_count:(null==t?void 0:t.active_lease_count)||0}});return(0,r.createApiResponse)(o)}catch(e){return console.error("PropertiesService.getAll exception:",e),(0,r.createApiResponse)(null,(0,r.handleSupabaseError)(e))}}static async getById(e){try{let t=(0,r.getSupabaseClient)(),{data:a,error:n}=await t.from("RENT_properties").select("*").eq("id",e).single();if(n)return(0,r.createApiResponse)(null,(0,r.handleSupabaseError)(n));let{data:s}=await t.from("RENT_tenants").select("*").eq("property_id",e).eq("is_active",!0),i={...a,tenants:s||[]};return(0,r.createApiResponse)(i)}catch(e){return(0,r.createApiResponse)(null,(0,r.handleSupabaseError)(e))}}static async create(e){try{let t=(0,r.getSupabaseClient)(),{data:a,error:n}=await t.from("RENT_properties").insert([e]).select().single();if(n)return(0,r.createApiResponse)(null,(0,r.handleSupabaseError)(n));return(0,r.createApiResponse)(a)}catch(e){return(0,r.createApiResponse)(null,(0,r.handleSupabaseError)(e))}}static async update(e,t){try{let a=(0,r.getSupabaseClient)(),{data:n,error:s}=await a.from("RENT_properties").update(t).eq("id",e).select().single();if(s)return(0,r.createApiResponse)(null,(0,r.handleSupabaseError)(s));return(0,r.createApiResponse)(n)}catch(e){return(0,r.createApiResponse)(null,(0,r.handleSupabaseError)(e))}}static async delete(e){try{let t=(0,r.getSupabaseClient)(),{error:a}=await t.from("RENT_properties").delete().eq("id",e);if(a)return(0,r.createApiResponse)(null,(0,r.handleSupabaseError)(a));return(0,r.createApiResponse)(!0)}catch(e){return(0,r.createApiResponse)(null,(0,r.handleSupabaseError)(e))}}static async getPaginated(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,a=arguments.length>2?arguments[2]:void 0;try{let n=(0,r.getSupabaseClient)(),s=(e-1)*t,i=n.from("RENT_properties").select("*",{count:"exact"}).order("created_at",{ascending:!1}).range(s,s+t-1);(null==a?void 0:a.is_for_rent)!==void 0&&(i=i.eq("is_for_rent",a.is_for_rent)),(null==a?void 0:a.is_for_sale)!==void 0&&(i=i.eq("is_for_sale",a.is_for_sale)),(null==a?void 0:a.city)&&(i=i.eq("city",a.city)),(null==a?void 0:a.state)&&(i=i.eq("state",a.state));let{data:l,error:o,count:c}=await i;if(o)return(0,r.createApiResponse)(null,(0,r.handleSupabaseError)(o));let p=await Promise.all(l.map(async e=>{let{data:t}=await n.from("RENT_tenants").select("*").eq("property_id",e.id);return{...e,tenants:t||[]}})),u=c||0;return(0,r.createApiResponse)({data:p,total:u,page:e,limit:t,hasMore:s+t<u})}catch(e){return(0,r.createApiResponse)(null,(0,r.handleSupabaseError)(e))}}static async search(e){try{let t=(0,r.getSupabaseClient)(),{data:a,error:n}=await t.from("RENT_properties").select("*").or("name.ilike.%".concat(e,"%,address.ilike.%").concat(e,"%,city.ilike.%").concat(e,"%")).order("created_at",{ascending:!1});if(n)return(0,r.createApiResponse)(null,(0,r.handleSupabaseError)(n));let s=await Promise.all(a.map(async e=>{let{data:a}=await t.from("RENT_tenants").select("*").eq("property_id",e.id);return{...e,tenants:a||[]}}));return(0,r.createApiResponse)(s)}catch(e){return(0,r.createApiResponse)(null,(0,r.handleSupabaseError)(e))}}static async getAvailableForRent(){return this.getAll({is_for_rent:!0})}static async getAvailableForSale(){return this.getAll({is_for_sale:!0})}}t.PropertiesService=s},8762:function(e,t,a){Object.defineProperty(t,"__esModule",{value:!0}),t.RentPeriodsService=void 0;let r=a(321);class n{static async createRentPeriods(e,t){try{let a=(0,r.getSupabaseClient)();if(!t.lease_start_date||!t.rent||!t.rent_cadence)return(0,r.createApiResponse)(null,"Missing lease information");let n=[],s=new Date(t.lease_start_date),i=new Date,l=new Date(s);for(;l<=i;){let a=new Date(l),r=(a<i?Math.floor((i.getTime()-a.getTime())/864e5):0)>5,s=0;if(r)switch(t.rent_cadence.toLowerCase().trim()){case"weekly":s=10;break;case"bi-weekly":case"biweekly":case"bi_weekly":s=20;break;default:s=50}switch(n.push({tenant_id:e.id,property_id:e.property_id||"",lease_id:t.id,period_due_date:a.toISOString().split("T")[0],rent_amount:t.rent,rent_cadence:t.rent_cadence,status:"unpaid",amount_paid:0,late_fee_applied:s,late_fee_waived:!1,due_date_override:void 0,notes:void 0}),t.rent_cadence.toLowerCase().trim()){case"weekly":l.setDate(l.getDate()+7);break;case"bi-weekly":case"biweekly":case"bi_weekly":l.setDate(l.getDate()+14);break;default:l.setMonth(l.getMonth()+1)}}let{data:o,error:c}=await a.from("RENT_rent_periods").insert(n).select("*");if(c)return(0,r.createApiResponse)(null,(0,r.handleSupabaseError)(c));return(0,r.createApiResponse)(o)}catch(e){return(0,r.createApiResponse)(null,(0,r.handleSupabaseError)(e))}}static async getTenantRentPeriods(e){try{let t=(0,r.getSupabaseClient)(),{data:a,error:n}=await t.from("RENT_rent_periods").select("*").eq("tenant_id",e).order("period_due_date",{ascending:!0});if(n)return(0,r.createApiResponse)(null,(0,r.handleSupabaseError)(n));return(0,r.createApiResponse)(a)}catch(e){return(0,r.createApiResponse)(null,(0,r.handleSupabaseError)(e))}}static async updateRentPeriod(e,t){try{let a=(0,r.getSupabaseClient)(),{data:n,error:s}=await a.from("RENT_rent_periods").update(t).eq("id",e).select("*").single();if(s)return(0,r.createApiResponse)(null,(0,r.handleSupabaseError)(s));return(0,r.createApiResponse)(n)}catch(e){return(0,r.createApiResponse)(null,(0,r.handleSupabaseError)(e))}}static async calculateTenantOwedAmount(e){try{let t=await this.getTenantRentPeriods(e);if(!t.success||!t.data)return(0,r.createApiResponse)(null,t.error);let a=t.data,n=0,s=0,i=0;for(let e of a)if("paid"!==e.status){let t=e.rent_amount-e.amount_paid;n+=t,e.late_fee_applied>0&&!e.late_fee_waived&&(s+=e.late_fee_applied),t>0&&i++}return(0,r.createApiResponse)({totalOwed:n,totalLateFees:s,missedPeriods:i,periods:a})}catch(e){return(0,r.createApiResponse)(null,(0,r.handleSupabaseError)(e))}}static async allocatePayment(e,t){try{let a=(0,r.getSupabaseClient)(),n=t.map(t=>({payment_id:e,rent_period_id:t.rent_period_id,amount_allocated:t.amount})),{error:s}=await a.from("RENT_payment_allocations").insert(n);if(s)return(0,r.createApiResponse)(null,(0,r.handleSupabaseError)(s));for(let e of t){let{data:t,error:n}=await a.from("RENT_rent_periods").select("amount_paid, rent_amount").eq("id",e.rent_period_id).single();if(n)return(0,r.createApiResponse)(null,(0,r.handleSupabaseError)(n));let s=(t.amount_paid||0)+e.amount,i=s>=t.rent_amount?"paid":"partial",{error:l}=await a.from("RENT_rent_periods").update({amount_paid:s,status:i}).eq("id",e.rent_period_id);if(l)return(0,r.createApiResponse)(null,(0,r.handleSupabaseError)(l))}return(0,r.createApiResponse)(!0)}catch(e){return(0,r.createApiResponse)(null,(0,r.handleSupabaseError)(e))}}}t.RentPeriodsService=n},2446:function(e,t,a){Object.defineProperty(t,"__esModule",{value:!0}),t.TenantsService=void 0;let r=a(321);class n{static async getAll(e){try{let t=(0,r.getSupabaseClient)(),a=t.from("RENT_tenants").select("*").order("created_at",{ascending:!1});(null==e?void 0:e.property_id)&&(a=a.eq("property_id",e.property_id)),(null==e?void 0:e.is_active)!==void 0&&(a=a.eq("is_active",e.is_active)),(null==e?void 0:e.late_status)&&(a=a.eq("late_status",e.late_status));let{data:n,error:s}=await a;if(s)return(0,r.createApiResponse)(null,(0,r.handleSupabaseError)(s));let i=await Promise.all(n.map(async e=>{let a=null;if(e.property_id){let{data:r}=await t.from("RENT_properties").select("id, name, address, notes, monthly_rent").eq("id",e.property_id).single();a=r}let{data:r}=await t.from("RENT_leases").select("*").eq("tenant_id",e.id).order("lease_start_date",{ascending:!1});return{...e,properties:a,leases:r||[]}}));return(0,r.createApiResponse)(i)}catch(e){return(0,r.createApiResponse)(null,(0,r.handleSupabaseError)(e))}}static async getById(e){try{let t=(0,r.getSupabaseClient)(),{data:a,error:n}=await t.from("RENT_tenants").select("*").eq("id",e).single();if(n)return(0,r.createApiResponse)(null,(0,r.handleSupabaseError)(n));let s=null;if(a.property_id){let{data:e}=await t.from("RENT_properties").select("id, name, address, notes, monthly_rent").eq("id",a.property_id).single();s=e}let{data:i}=await t.from("RENT_leases").select("*").eq("tenant_id",a.id).order("lease_start_date",{ascending:!1}),l={...a,properties:s,leases:i||[]};return(0,r.createApiResponse)(l)}catch(e){return(0,r.createApiResponse)(null,(0,r.handleSupabaseError)(e))}}static async create(e){try{let t=(0,r.getSupabaseClient)();console.log("TenantsService.create - Input data:",e);let a={property_id:e.property_id,first_name:e.first_name,last_name:e.last_name,email:e.email,phone:e.phone,lease_start_date:e.lease_start_date,lease_end_date:e.lease_end_date,notes:e.notes};console.log("TenantsService.create - Insert data (filtered):",a);let{data:n,error:s}=await t.from("RENT_tenants").insert([a]).select("*").single();if(s)return console.error("TenantsService.create - Supabase error:",s),(0,r.createApiResponse)(null,(0,r.handleSupabaseError)(s));return console.log("TenantsService.create - Success, created tenant:",n),(0,r.createApiResponse)(n)}catch(e){return console.error("TenantsService.create - Unexpected error:",e),(0,r.createApiResponse)(null,(0,r.handleSupabaseError)(e))}}static async update(e,t){try{let a=(0,r.getSupabaseClient)(),{data:n,error:s}=await a.from("RENT_tenants").update(t).eq("id",e).select("*").single();if(s)return(0,r.createApiResponse)(null,(0,r.handleSupabaseError)(s));if(t.rent_cadence&&n.property_id){let{data:e}=await a.from("RENT_leases").select("id, lease_start_date, lease_end_date").eq("tenant_id",n.id).eq("status","active").single();if(e)await a.from("RENT_leases").update({rent_cadence:t.rent_cadence,rent:t.monthly_rent||0,lease_start_date:t.lease_start_date||e.lease_start_date,lease_end_date:t.lease_end_date||e.lease_end_date}).eq("id",e.id);else{let e={tenant_id:n.id,property_id:n.property_id,lease_start_date:t.lease_start_date||new Date().toISOString(),lease_end_date:t.lease_end_date||new Date(Date.now()+31536e6).toISOString(),rent:t.monthly_rent||0,rent_cadence:t.rent_cadence,move_in_fee:0,late_fee_amount:50,status:"active"};await a.from("RENT_leases").insert([e])}}let i=null;if(n.property_id){let{data:e}=await a.from("RENT_properties").select("id, name, address, notes, monthly_rent").eq("id",n.property_id).single();i=e}let{data:l}=await a.from("RENT_leases").select("*").eq("tenant_id",n.id).order("lease_start_date",{ascending:!1}),o={...n,properties:i,leases:l||[]};return(0,r.createApiResponse)(o)}catch(e){return(0,r.createApiResponse)(null,(0,r.handleSupabaseError)(e))}}static async delete(e){try{let t=(0,r.getSupabaseClient)(),{error:a}=await t.from("RENT_tenants").delete().eq("id",e);if(a)return(0,r.createApiResponse)(null,(0,r.handleSupabaseError)(a));return(0,r.createApiResponse)(!0)}catch(e){return(0,r.createApiResponse)(null,(0,r.handleSupabaseError)(e))}}static async getPaginated(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,a=arguments.length>2?arguments[2]:void 0;try{let n=(0,r.getSupabaseClient)(),s=(e-1)*t,i=n.from("RENT_tenants").select("*",{count:"exact"}).order("created_at",{ascending:!1}).range(s,s+t-1);(null==a?void 0:a.property_id)&&(i=i.eq("property_id",a.property_id)),(null==a?void 0:a.is_active)!==void 0&&(i=i.eq("is_active",a.is_active)),(null==a?void 0:a.late_status)&&(i=i.eq("late_status",a.late_status));let{data:l,error:o,count:c}=await i;if(o)return(0,r.createApiResponse)(null,(0,r.handleSupabaseError)(o));let p=await Promise.all(l.map(async e=>{let t=null;if(e.property_id){let{data:a}=await n.from("RENT_properties").select("id, name, address").eq("id",e.property_id).single();t=a}let{data:a}=await n.from("RENT_leases").select("*").eq("tenant_id",e.id).order("lease_start_date",{ascending:!1});return{...e,properties:t,leases:a||[]}}));return(0,r.createApiResponse)({data:p,total:c||0,page:e,limit:t,hasMore:s+t<(c||0)})}catch(e){return(0,r.createApiResponse)(null,(0,r.handleSupabaseError)(e))}}static async search(e){try{let t=(0,r.getSupabaseClient)(),{data:a,error:n}=await t.from("RENT_tenants").select("*").or("first_name.ilike.%".concat(e,"%,last_name.ilike.%").concat(e,"%,email.ilike.%").concat(e,"%")).order("created_at",{ascending:!1});if(n)return(0,r.createApiResponse)(null,(0,r.handleSupabaseError)(n));let s=await Promise.all(a.map(async e=>{let a=null;if(e.property_id){let{data:r}=await t.from("RENT_properties").select("id, name, address").eq("id",e.property_id).single();a=r}let{data:r}=await t.from("RENT_leases").select("*").eq("tenant_id",e.id).order("lease_start_date",{ascending:!1});return{...e,properties:a,leases:r||[]}}));return(0,r.createApiResponse)(s)}catch(e){return(0,r.createApiResponse)(null,(0,r.handleSupabaseError)(e))}}static async getActive(){return this.getAll({is_active:!0})}static async getLate(){try{let e=(0,r.getSupabaseClient)(),{data:t,error:a}=await e.from("RENT_tenants").select("*").neq("late_status","on_time").order("created_at",{ascending:!1});if(a)return(0,r.createApiResponse)(null,(0,r.handleSupabaseError)(a));let n=await Promise.all(t.map(async t=>{let a=null;if(t.property_id){let{data:r}=await e.from("RENT_properties").select("id, name, address").eq("id",t.property_id).single();a=r}let{data:r}=await e.from("RENT_leases").select("*").eq("tenant_id",t.id).order("lease_start_date",{ascending:!1});return{...t,properties:a,leases:r||[]}}));return(0,r.createApiResponse)(n)}catch(e){return(0,r.createApiResponse)(null,(0,r.handleSupabaseError)(e))}}static async getByProperty(e){return this.getAll({property_id:e})}static async recordPayment(e,t){try{let a=(0,r.getSupabaseClient)(),{data:n,error:s}=await a.from("RENT_tenants").select("*").eq("id",e).single();if(s)return(0,r.createApiResponse)(null,(0,r.handleSupabaseError)(s));if(!n)return(0,r.createApiResponse)(null,"Tenant not found");let i=null;if(n.property_id){let{data:e}=await a.from("RENT_properties").select("id, name, address, notes, monthly_rent").eq("id",n.property_id).single();i=e}let l=[...n.payment_history,{date:t.payment_date,amount:t.amount,status:"completed"}],o="on_time",c=0;if(i&&n.lease_start_date){let e={...n,payment_history:l},t=this.calculateTotalLatePayments(e,i);t.totalDue>0&&(c=t.totalLateFees,o=t.latePeriods>=3?"eviction_notice":t.latePeriods>=2?"late_10_days":"late_5_days")}let{data:p,error:u}=await a.from("RENT_tenants").update({payment_history:l,last_payment_date:t.payment_date,late_fees_owed:c,late_status:o}).eq("id",e).select("*, RENT_properties(name, address, notes, monthly_rent)").single();if(u)return(0,r.createApiResponse)(null,(0,r.handleSupabaseError)(u));return(0,r.createApiResponse)(p)}catch(e){return(0,r.createApiResponse)(null,(0,r.handleSupabaseError)(e))}}static async getLateTenants(){try{let e=(0,r.getSupabaseClient)(),{data:t,error:a}=await e.from("RENT_tenants").select("*").eq("is_active",!0).order("created_at",{ascending:!1});if(a)return(0,r.createApiResponse)(null,(0,r.handleSupabaseError)(a));let n=await Promise.all(t.map(async t=>{let a=null;if(t.property_id){let{data:r}=await e.from("RENT_properties").select("id, name, address, city, state, zip_code, property_type, monthly_rent, notes").eq("id",t.property_id).single();a=r}let{data:r}=await e.from("RENT_leases").select("id, lease_start_date, lease_end_date, rent, rent_cadence, status").eq("tenant_id",t.id).eq("status","active").order("lease_start_date",{ascending:!1}),{data:n}=await e.from("RENT_payments").select("id, amount, payment_date, payment_type").eq("tenant_id",t.id).order("payment_date",{ascending:!1});return{...t,properties:a,leases:r||[],actualPayments:n||[]}})),s=[];for(let e of n){if(!e.properties||!e.leases||0===e.leases.length)continue;let t=e.leases[0];if(!t.lease_start_date||!t.rent)continue;let a=new Date(t.lease_start_date),r=new Date;if(a>r||t.rent<=0)continue;let n=Math.floor((r.getTime()-a.getTime())/864e5);if(n<7||n>3650)continue;let i=t.rent_cadence||"monthly",l=0,o=30;switch(i.toLowerCase().trim()){case"weekly":l=Math.ceil(n/7),o=7;break;case"bi-weekly":case"biweekly":case"bi_weekly":l=Math.ceil(n/14),o=14;break;default:l=Math.ceil(n/30),o=30}let c=t.rent*l,p=(e.actualPayments||[]).reduce((e,t)=>e+t.amount,0),u=!1,d=0,_=0,y=0;if(p<c){u=!0,d=c-p;let e=t.rent;if(_=Math.ceil(d/e),l>0){let e=new Date(a);e.setDate(e.getDate()+o*(l-1));let t=new Date(e);t.setDate(t.getDate()+5),r>t?y=Math.floor((r.getTime()-t.getTime())/864e5):(y=Math.floor((r.getTime()-e.getTime())/864e5))<0&&(y=0)}}else{let n=(e.actualPayments||[]).sort((e,t)=>new Date(e.payment_date).getTime()-new Date(t.payment_date).getTime());if(n.length>0){let e=n[n.length-1],s=new Date(e.payment_date),i=new Date(a);i.setDate(i.getDate()+o*(l-1));let c=new Date(i);c.setDate(c.getDate()+5),s>c&&(u=!0,d=t.rent,_=1,y=Math.floor((r.getTime()-c.getTime())/864e5))}}if(u){let t=0;switch(i.toLowerCase().trim()){case"weekly":t=10;break;case"bi-weekly":case"biweekly":case"bi_weekly":t=20;break;default:t=50}let a=t*_,r={...e,properties:e.properties,total_due:d,total_late_fees:a,total_outstanding:d,late_periods:_,days_late:Math.max(0,y)};s.push(r)}}return(0,r.createApiResponse)(s)}catch(e){return(0,r.createApiResponse)(null,(0,r.handleSupabaseError)(e))}}static calculateTotalDue(e){return e.properties?this.calculateTotalLatePayments(e,e.properties).totalDue:(e.monthly_rent||0)+(e.late_fees_owed||0)}static calculateDaysLate(e){if(!e)return 0;let t=new Date(e);return Math.ceil(Math.abs(new Date().getTime()-t.getTime())/864e5)}static calculateLatePeriods(e,t){if(!e.leases||0===e.leases.length)return 0;switch((e.leases[0].rent_cadence||"monthly").toLowerCase().trim()){case"weekly":return Math.ceil(t/7);case"bi-weekly":case"biweekly":case"bi_weekly":return Math.ceil(t/14);default:return Math.ceil(t/30)}}static calculateLateFees(e,t){if(!e.leases||0===e.leases.length)return 0;let a=(e.leases[0].rent_cadence||"monthly").toLowerCase().trim(),r=0;switch(a){case"weekly":r=10;break;case"bi-weekly":case"biweekly":case"bi_weekly":r=20;break;default:r=50}return t*r}static calculateTotalDueWithLateFees(e,t){return(e.leases&&e.leases.length>0?e.leases[0].rent:e.monthly_rent||0)+t}static calculateTenantOwedAmount(e){if(!e.leases||0===e.leases.length)return{totalOwed:0,totalLateFees:0,missedPeriods:0,missedPayments:[]};let t=e.leases[0],a=t.rent||e.monthly_rent||0,r=t.rent_cadence||"monthly",n=new Date(e.currently_paid_up_date?e.currently_paid_up_date:e.last_payment_date?e.last_payment_date:t.lease_start_date),s=new Date,i=new Date(n),l=0,o=0,c=0,p=[];for(;i<=s;){let e=new Date(i),t=Math.floor((s.getTime()-e.getTime())/864e5)>5,n=t?this.getLateFeeAmount(r):0;switch(l+=a+n,o+=n,c++,p.push({dueDate:e,amount:a,isLate:t,lateFee:n}),r.toLowerCase().trim()){case"weekly":i.setDate(i.getDate()+7);break;case"bi-weekly":case"biweekly":case"bi_weekly":i.setDate(i.getDate()+14);break;default:i.setMonth(i.getMonth()+1)}}return{totalOwed:l,totalLateFees:o,missedPeriods:c,missedPayments:p}}static calculateDaysLateFromPaidUpDate(e){if(!e.leases||0===e.leases.length)return 0;let t=e.leases[0],a=t.rent_cadence||"monthly",r=new Date(e.currently_paid_up_date?e.currently_paid_up_date:e.last_payment_date?e.last_payment_date:t.lease_start_date),n=new Date,s=new Date(r),i=0;for(;s<=n;){let e=new Date(s),t=Math.floor((n.getTime()-e.getTime())/864e5);switch(t>5&&(i+=t-5),a.toLowerCase().trim()){case"weekly":s.setDate(s.getDate()+7);break;case"bi-weekly":case"biweekly":case"bi_weekly":s.setDate(s.getDate()+14);break;default:s.setMonth(s.getMonth()+1)}}return i}static getLateFeeAmount(e){switch(e.toLowerCase().trim()){case"weekly":return 10;case"bi-weekly":case"biweekly":case"bi_weekly":return 20;default:return 45}}static extractRentCadence(e){if(!e)return"monthly";let t=e.match(/Rent cadence:\s*(\w+)/i);return t?t[1]:"monthly"}static daysBetween(e,t){let a=new Date(e);return Math.ceil(Math.abs(new Date(t).getTime()-a.getTime())/864e5)}static getExpectedPaymentDate(e,t,a){let r=new Date(e);switch(a.toLowerCase().trim()){case"weekly":return new Date(r.getTime()+6048e5*t);case"bi-weekly":case"biweekly":case"bi_weekly":return new Date(r.getTime()+12096e5*t);default:let n=new Date(r);return n.setMonth(n.getMonth()+t),n}}static getLastExpectedPaymentDates(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:12,r=[],n=new Date,s=0,i=this.getExpectedPaymentDate(e,s,t);for(;i<=n&&s<2*a;)s++,i=this.getExpectedPaymentDate(e,s,t);for(let n=Math.max(0,s-a);n<s;n++)r.push(this.getExpectedPaymentDate(e,n,t));return r}static calculateLateFeesForPeriod(e,t,a,r){let n=this.getLateFeeAmount(a),s=new Date(e);s.setDate(s.getDate()-2);let i=new Date(e);i.setDate(i.getDate()+5);let l=t.filter(e=>{let t=new Date(e.date);return t>=s&&t<=i&&"completed"===e.status}),o=l.reduce((e,t)=>e+t.amount,0),c=Math.max(0,r-o),p=l.length>0?new Date(Math.max(...l.map(e=>new Date(e.date).getTime()))):null;return!p||p>i?{isLate:!0,daysLate:Math.max(0,p?this.daysBetween(i,p):this.daysBetween(i,new Date)),lateFees:c>0?n:0,totalPaid:o,outstanding:c}:{isLate:!1,daysLate:0,lateFees:0,totalPaid:o,outstanding:c}}static calculateTotalLatePayments(e,t){if(!e.leases||0===e.leases.length)return{totalLateFees:0,totalOutstanding:0,totalDue:0,latePeriods:0,payPeriods:[]};let a=e.leases[0];if(!a.lease_start_date||!a.rent)return{totalLateFees:0,totalOutstanding:0,totalDue:0,latePeriods:0,payPeriods:[]};let r=a.rent_cadence||"monthly",n=a.rent,s=this.getLastExpectedPaymentDates(a.lease_start_date,r,12),i=0,l=0,o=0,c=s.map(t=>{let a=this.calculateLateFeesForPeriod(t,e.payment_history||[],r,n);return a.isLate&&(i+=a.lateFees,l+=a.outstanding,o++),{expectedDate:t,...a}});return{totalLateFees:i,totalOutstanding:l,totalDue:i+l,latePeriods:o,payPeriods:c}}static isTenantLate(e,t){return this.calculateTotalLatePayments(e,t).totalDue>0}static async createByPropertyAddress(e){try{let t=(0,r.getSupabaseClient)(),{data:a,error:n}=await t.from("RENT_properties").select("id, monthly_rent").ilike("address","%".concat(e.property_address,"%")).single();if(n)return(0,r.createApiResponse)(null,"Property not found with address: ".concat(e.property_address));let{property_address:s,...i}=e,l={...i,property_id:a.id,monthly_rent:e.monthly_rent||a.monthly_rent},{data:o,error:c}=await t.from("RENT_tenants").insert([l]).select("*, RENT_properties(name, address)").single();if(c)return(0,r.createApiResponse)(null,(0,r.handleSupabaseError)(c));return(0,r.createApiResponse)(o)}catch(e){return(0,r.createApiResponse)(null,(0,r.handleSupabaseError)(e))}}static async bulkCreateByPropertyAddress(e){try{(0,r.getSupabaseClient)();let t=[],a=[];for(let r of e)try{let e=await this.createByPropertyAddress(r);e.success&&e.data?t.push(e.data):a.push("Failed to create tenant ".concat(r.first_name," ").concat(r.last_name,": ").concat(e.error))}catch(e){a.push("Error creating tenant ".concat(r.first_name," ").concat(r.last_name,": ").concat(e))}return(0,r.createApiResponse)({created:t,errors:a})}catch(e){return(0,r.createApiResponse)(null,(0,r.handleSupabaseError)(e))}}}t.TenantsService=n},2160:function(e,t,a){Object.defineProperty(t,"__esModule",{value:!0}),t.TransactionsService=void 0;let r=a(321);class n{static async getAll(e){try{let t=(0,r.getSupabaseClient)().from("RENT_transactions").select("*").order("transaction_date",{ascending:!1});(null==e?void 0:e.transaction_type)&&(t=t.eq("transaction_type",e.transaction_type)),(null==e?void 0:e.tenant_id)&&(t=t.eq("tenant_id",e.tenant_id)),(null==e?void 0:e.property_id)&&(t=t.eq("property_id",e.property_id)),(null==e?void 0:e.payment_status)&&(t=t.eq("payment_status",e.payment_status)),(null==e?void 0:e.start_date)&&(t=t.gte("transaction_date",e.start_date)),(null==e?void 0:e.end_date)&&(t=t.lte("transaction_date",e.end_date));let{data:a,error:n}=await t;if(n)return(0,r.createApiResponse)(null,(0,r.handleSupabaseError)(n));return(0,r.createApiResponse)(a)}catch(e){return(0,r.createApiResponse)(null,(0,r.handleSupabaseError)(e))}}static async getById(e){try{let t=(0,r.getSupabaseClient)(),{data:a,error:n}=await t.from("RENT_transactions").select("*").eq("id",e).single();if(n)return(0,r.createApiResponse)(null,(0,r.handleSupabaseError)(n));return(0,r.createApiResponse)(a)}catch(e){return(0,r.createApiResponse)(null,(0,r.handleSupabaseError)(e))}}static async create(e){try{let t=(0,r.getSupabaseClient)(),{data:a,error:n}=await t.from("RENT_transactions").insert([e]).select().single();if(n)return(0,r.createApiResponse)(null,(0,r.handleSupabaseError)(n));return(0,r.createApiResponse)(a)}catch(e){return(0,r.createApiResponse)(null,(0,r.handleSupabaseError)(e))}}static async update(e,t){try{let a=(0,r.getSupabaseClient)(),{data:n,error:s}=await a.from("RENT_transactions").update(t).eq("id",e).select().single();if(s)return(0,r.createApiResponse)(null,(0,r.handleSupabaseError)(s));return(0,r.createApiResponse)(n)}catch(e){return(0,r.createApiResponse)(null,(0,r.handleSupabaseError)(e))}}static async delete(e){try{let t=(0,r.getSupabaseClient)(),{error:a}=await t.from("RENT_transactions").delete().eq("id",e);if(a)return(0,r.createApiResponse)(null,(0,r.handleSupabaseError)(a));return(0,r.createApiResponse)(!0)}catch(e){return(0,r.createApiResponse)(null,(0,r.handleSupabaseError)(e))}}static async getPaginated(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,a=arguments.length>2?arguments[2]:void 0;try{let n=(0,r.getSupabaseClient)(),s=(e-1)*t,i=n.from("RENT_transactions").select("*",{count:"exact"}).order("transaction_date",{ascending:!1}).range(s,s+t-1);(null==a?void 0:a.transaction_type)&&(i=i.eq("transaction_type",a.transaction_type)),(null==a?void 0:a.tenant_id)&&(i=i.eq("tenant_id",a.tenant_id)),(null==a?void 0:a.property_id)&&(i=i.eq("property_id",a.property_id)),(null==a?void 0:a.payment_status)&&(i=i.eq("payment_status",a.payment_status)),(null==a?void 0:a.start_date)&&(i=i.gte("transaction_date",a.start_date)),(null==a?void 0:a.end_date)&&(i=i.lte("transaction_date",a.end_date));let{data:l,error:o,count:c}=await i;if(o)return(0,r.createApiResponse)(null,(0,r.handleSupabaseError)(o));let p=c||0;return(0,r.createApiResponse)({data:l,total:p,page:e,limit:t,hasMore:s+t<p})}catch(e){return(0,r.createApiResponse)(null,(0,r.handleSupabaseError)(e))}}static async getRentPayments(e){return this.getAll({transaction_type:"rent_payment",...e})}static async getLoanPayments(e){return this.getAll({transaction_type:"loan_payment",...e})}static async getByDateRange(e,t){return this.getAll({start_date:e,end_date:t})}static async getTotalIncome(e,t){try{let a=(0,r.getSupabaseClient)(),{data:n,error:s}=await a.from("RENT_transactions").select("amount").in("transaction_type",["rent_payment","income","property_sale"]).gte("transaction_date",e).lte("transaction_date",t).eq("payment_status","completed");if(s)return(0,r.createApiResponse)(null,(0,r.handleSupabaseError)(s));let i=(null==n?void 0:n.reduce((e,t)=>e+(t.amount||0),0))||0;return(0,r.createApiResponse)(i)}catch(e){return(0,r.createApiResponse)(null,(0,r.handleSupabaseError)(e))}}static async getTotalExpenses(e,t){try{let a=(0,r.getSupabaseClient)(),{data:n,error:s}=await a.from("RENT_transactions").select("amount").in("transaction_type",["expense","loan_payment","property_purchase"]).gte("transaction_date",e).lte("transaction_date",t).eq("payment_status","completed");if(s)return(0,r.createApiResponse)(null,(0,r.handleSupabaseError)(s));let i=(null==n?void 0:n.reduce((e,t)=>e+(t.amount||0),0))||0;return(0,r.createApiResponse)(i)}catch(e){return(0,r.createApiResponse)(null,(0,r.handleSupabaseError)(e))}}}t.TransactionsService=n},2287:function(e,t){Object.defineProperty(t,"__esModule",{value:!0})},4253:function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}}]);