(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[557],{6996:function(e,t,a){Promise.resolve().then(a.bind(a,1140))},1140:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return m}});var r=a(7573),s=a(7653),l=a(1695),n=a(2346);class i{static async getAll(e){try{let t=(0,n.Ng)(),a=t.from("RENT_tenants").select("*").order("created_at",{ascending:!1});(null==e?void 0:e.property_id)&&(a=a.eq("property_id",e.property_id)),(null==e?void 0:e.is_active)!==void 0&&(a=a.eq("is_active",e.is_active)),(null==e?void 0:e.late_status)&&(a=a.eq("late_status",e.late_status));let{data:r,error:s}=await a;if(s)return(0,n.ql)(null,(0,n.Iu)(s));let l=await Promise.all(r.map(async e=>{let a=null;if(e.property_id){let{data:r}=await t.from("RENT_properties").select("id, name, address, notes, monthly_rent").eq("id",e.property_id).single();a=r}let{data:r}=await t.from("RENT_leases").select("*").eq("tenant_id",e.id).order("lease_start_date",{ascending:!1});return{...e,properties:a,leases:r||[]}}));return(0,n.ql)(l)}catch(e){return(0,n.ql)(null,(0,n.Iu)(e))}}static async getById(e){try{let t=(0,n.Ng)(),{data:a,error:r}=await t.from("RENT_tenants").select("*").eq("id",e).single();if(r)return(0,n.ql)(null,(0,n.Iu)(r));let s=null;if(a.property_id){let{data:e}=await t.from("RENT_properties").select("id, name, address, notes, monthly_rent").eq("id",a.property_id).single();s=e}let{data:l}=await t.from("RENT_leases").select("*").eq("tenant_id",a.id).order("lease_start_date",{ascending:!1}),i={...a,properties:s,leases:l||[]};return(0,n.ql)(i)}catch(e){return(0,n.ql)(null,(0,n.Iu)(e))}}static async create(e){try{let t=(0,n.Ng)();console.log("TenantsService.create - Input data:",e);let a={property_id:e.property_id,first_name:e.first_name,last_name:e.last_name,email:e.email,phone:e.phone,lease_start_date:e.lease_start_date,lease_end_date:e.lease_end_date,notes:e.notes};console.log("TenantsService.create - Insert data (filtered):",a);let{data:r,error:s}=await t.from("RENT_tenants").insert([a]).select("*").single();if(s)return console.error("TenantsService.create - Supabase error:",s),(0,n.ql)(null,(0,n.Iu)(s));return console.log("TenantsService.create - Success, created tenant:",r),(0,n.ql)(r)}catch(e){return console.error("TenantsService.create - Unexpected error:",e),(0,n.ql)(null,(0,n.Iu)(e))}}static async update(e,t){try{let a=(0,n.Ng)(),{data:r,error:s}=await a.from("RENT_tenants").update(t).eq("id",e).select("*").single();if(s)return(0,n.ql)(null,(0,n.Iu)(s));if(t.rent_cadence&&r.property_id){let{data:e}=await a.from("RENT_leases").select("id, lease_start_date, lease_end_date").eq("tenant_id",r.id).eq("status","active").single();if(e)await a.from("RENT_leases").update({rent_cadence:t.rent_cadence,rent:t.monthly_rent||0,lease_start_date:t.lease_start_date||e.lease_start_date,lease_end_date:t.lease_end_date||e.lease_end_date}).eq("id",e.id);else{let e={tenant_id:r.id,property_id:r.property_id,lease_start_date:t.lease_start_date||new Date().toISOString(),lease_end_date:t.lease_end_date||new Date(Date.now()+31536e6).toISOString(),rent:t.monthly_rent||0,rent_cadence:t.rent_cadence,move_in_fee:0,late_fee_amount:50,status:"active"};await a.from("RENT_leases").insert([e])}}let l=null;if(r.property_id){let{data:e}=await a.from("RENT_properties").select("id, name, address, notes, monthly_rent").eq("id",r.property_id).single();l=e}let{data:i}=await a.from("RENT_leases").select("*").eq("tenant_id",r.id).order("lease_start_date",{ascending:!1}),d={...r,properties:l,leases:i||[]};return(0,n.ql)(d)}catch(e){return(0,n.ql)(null,(0,n.Iu)(e))}}static async delete(e){try{let t=(0,n.Ng)(),{error:a}=await t.from("RENT_tenants").delete().eq("id",e);if(a)return(0,n.ql)(null,(0,n.Iu)(a));return(0,n.ql)(!0)}catch(e){return(0,n.ql)(null,(0,n.Iu)(e))}}static async getPaginated(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,a=arguments.length>2?arguments[2]:void 0;try{let r=(0,n.Ng)(),s=(e-1)*t,l=r.from("RENT_tenants").select("*",{count:"exact"}).order("created_at",{ascending:!1}).range(s,s+t-1);(null==a?void 0:a.property_id)&&(l=l.eq("property_id",a.property_id)),(null==a?void 0:a.is_active)!==void 0&&(l=l.eq("is_active",a.is_active)),(null==a?void 0:a.late_status)&&(l=l.eq("late_status",a.late_status));let{data:i,error:d,count:c}=await l;if(d)return(0,n.ql)(null,(0,n.Iu)(d));let o=await Promise.all(i.map(async e=>{let t=null;if(e.property_id){let{data:a}=await r.from("RENT_properties").select("id, name, address").eq("id",e.property_id).single();t=a}let{data:a}=await r.from("RENT_leases").select("*").eq("tenant_id",e.id).order("lease_start_date",{ascending:!1});return{...e,properties:t,leases:a||[]}}));return(0,n.ql)({data:o,total:c||0,page:e,limit:t,hasMore:s+t<(c||0)})}catch(e){return(0,n.ql)(null,(0,n.Iu)(e))}}static async search(e){try{let t=(0,n.Ng)(),{data:a,error:r}=await t.from("RENT_tenants").select("*").or("first_name.ilike.%".concat(e,"%,last_name.ilike.%").concat(e,"%,email.ilike.%").concat(e,"%")).order("created_at",{ascending:!1});if(r)return(0,n.ql)(null,(0,n.Iu)(r));let s=await Promise.all(a.map(async e=>{let a=null;if(e.property_id){let{data:r}=await t.from("RENT_properties").select("id, name, address").eq("id",e.property_id).single();a=r}let{data:r}=await t.from("RENT_leases").select("*").eq("tenant_id",e.id).order("lease_start_date",{ascending:!1});return{...e,properties:a,leases:r||[]}}));return(0,n.ql)(s)}catch(e){return(0,n.ql)(null,(0,n.Iu)(e))}}static async getActive(){return this.getAll({is_active:!0})}static async getLate(){try{let e=(0,n.Ng)(),{data:t,error:a}=await e.from("RENT_tenants").select("*").neq("late_status","on_time").order("created_at",{ascending:!1});if(a)return(0,n.ql)(null,(0,n.Iu)(a));let r=await Promise.all(t.map(async t=>{let a=null;if(t.property_id){let{data:r}=await e.from("RENT_properties").select("id, name, address").eq("id",t.property_id).single();a=r}let{data:r}=await e.from("RENT_leases").select("*").eq("tenant_id",t.id).order("lease_start_date",{ascending:!1});return{...t,properties:a,leases:r||[]}}));return(0,n.ql)(r)}catch(e){return(0,n.ql)(null,(0,n.Iu)(e))}}static async getByProperty(e){return this.getAll({property_id:e})}static async recordPayment(e,t){try{let a=(0,n.Ng)(),{data:r,error:s}=await a.from("RENT_tenants").select("*").eq("id",e).single();if(s)return(0,n.ql)(null,(0,n.Iu)(s));if(!r)return(0,n.ql)(null,"Tenant not found");let l=null;if(r.property_id){let{data:e}=await a.from("RENT_properties").select("id, name, address, notes, monthly_rent").eq("id",r.property_id).single();l=e}let i=[...r.payment_history,{date:t.payment_date,amount:t.amount,status:"completed"}],d="on_time",c=0;if(l&&r.lease_start_date){let e={...r,payment_history:i},t=this.calculateTotalLatePayments(e,l);t.totalDue>0&&(c=t.totalLateFees,d=t.latePeriods>=3?"eviction_notice":t.latePeriods>=2?"late_10_days":"late_5_days")}let{data:o,error:u}=await a.from("RENT_tenants").update({payment_history:i,last_payment_date:t.payment_date,late_fees_owed:c,late_status:d}).eq("id",e).select("*, RENT_properties(name, address, notes, monthly_rent)").single();if(u)return(0,n.ql)(null,(0,n.Iu)(u));return(0,n.ql)(o)}catch(e){return(0,n.ql)(null,(0,n.Iu)(e))}}static async getLateTenants(){try{let e=(0,n.Ng)(),{data:t,error:a}=await e.from("RENT_tenants").select("*").eq("is_active",!0).order("created_at",{ascending:!1});if(a)return(0,n.ql)(null,(0,n.Iu)(a));let r=await Promise.all(t.map(async t=>{let a=null;if(t.property_id){let{data:r}=await e.from("RENT_properties").select("id, name, address, city, state, zip_code, property_type, monthly_rent, notes").eq("id",t.property_id).single();a=r}let{data:r}=await e.from("RENT_leases").select("id, lease_start_date, lease_end_date, rent, rent_cadence, status").eq("tenant_id",t.id).eq("status","active").order("lease_start_date",{ascending:!1}),{data:s}=await e.from("RENT_payments").select("id, amount, payment_date, payment_type").eq("tenant_id",t.id).order("payment_date",{ascending:!1});return{...t,properties:a,leases:r||[],actualPayments:s||[]}})),s=[];for(let e of r){if(!e.properties||!e.leases||0===e.leases.length)continue;let t=e.leases[0];if(!t.lease_start_date||!t.rent)continue;let a=new Date(t.lease_start_date),r=new Date;if(a>r||t.rent<=0)continue;let l=Math.floor((r.getTime()-a.getTime())/864e5);if(l<7||l>3650)continue;let n=t.rent_cadence||"monthly",i=0,d=30;switch(n.toLowerCase().trim()){case"weekly":i=Math.ceil(l/7),d=7;break;case"bi-weekly":case"biweekly":case"bi_weekly":i=Math.ceil(l/14),d=14;break;default:i=Math.ceil(l/30),d=30}let c=t.rent*i,o=(e.actualPayments||[]).reduce((e,t)=>e+t.amount,0),u=!1,m=0,p=0,y=0;if(o<c){u=!0,m=c-o;let e=t.rent;if(p=Math.ceil(m/e),i>0){let e=new Date(a);e.setDate(e.getDate()+d*(i-1));let t=new Date(e);t.setDate(t.getDate()+5),r>t?y=Math.floor((r.getTime()-t.getTime())/864e5):(y=Math.floor((r.getTime()-e.getTime())/864e5))<0&&(y=0)}}else{let s=(e.actualPayments||[]).sort((e,t)=>new Date(e.payment_date).getTime()-new Date(t.payment_date).getTime());if(s.length>0){let e=s[s.length-1],l=new Date(e.payment_date),n=new Date(a);n.setDate(n.getDate()+d*(i-1));let c=new Date(n);c.setDate(c.getDate()+5),l>c&&(u=!0,m=t.rent,p=1,y=Math.floor((r.getTime()-c.getTime())/864e5))}}if(u){let t=0;switch(n.toLowerCase().trim()){case"weekly":t=10;break;case"bi-weekly":case"biweekly":case"bi_weekly":t=20;break;default:t=50}let a=t*p,r={...e,properties:e.properties,total_due:m,total_late_fees:a,total_outstanding:m,late_periods:p,days_late:Math.max(0,y)};s.push(r)}}return(0,n.ql)(s)}catch(e){return(0,n.ql)(null,(0,n.Iu)(e))}}static calculateTotalDue(e){return e.properties?this.calculateTotalLatePayments(e,e.properties).totalDue:(e.monthly_rent||0)+(e.late_fees_owed||0)}static calculateDaysLate(e){if(!e)return 0;let t=new Date(e);return Math.ceil(Math.abs(new Date().getTime()-t.getTime())/864e5)}static calculateLatePeriods(e,t){if(!e.leases||0===e.leases.length)return 0;switch((e.leases[0].rent_cadence||"monthly").toLowerCase().trim()){case"weekly":return Math.ceil(t/7);case"bi-weekly":case"biweekly":case"bi_weekly":return Math.ceil(t/14);default:return Math.ceil(t/30)}}static calculateLateFees(e,t){if(!e.leases||0===e.leases.length)return 0;let a=(e.leases[0].rent_cadence||"monthly").toLowerCase().trim(),r=0;switch(a){case"weekly":r=10;break;case"bi-weekly":case"biweekly":case"bi_weekly":r=20;break;default:r=50}return t*r}static calculateTotalDueWithLateFees(e,t){return(e.leases&&e.leases.length>0?e.leases[0].rent:e.monthly_rent||0)+t}static calculateTenantOwedAmount(e){if(!e.leases||0===e.leases.length)return{totalOwed:0,totalLateFees:0,missedPeriods:0,missedPayments:[]};let t=e.leases[0],a=t.rent||e.monthly_rent||0,r=t.rent_cadence||"monthly",s=new Date(e.currently_paid_up_date?e.currently_paid_up_date:e.last_payment_date?e.last_payment_date:t.lease_start_date),l=new Date,n=new Date(s),i=0,d=0,c=0,o=[];for(;n<=l;){let e=new Date(n),t=Math.floor((l.getTime()-e.getTime())/864e5)>5,s=t?this.getLateFeeAmount(r):0;switch(i+=a+s,d+=s,c++,o.push({dueDate:e,amount:a,isLate:t,lateFee:s}),r.toLowerCase().trim()){case"weekly":n.setDate(n.getDate()+7);break;case"bi-weekly":case"biweekly":case"bi_weekly":n.setDate(n.getDate()+14);break;default:n.setMonth(n.getMonth()+1)}}return{totalOwed:i,totalLateFees:d,missedPeriods:c,missedPayments:o}}static calculateDaysLateFromPaidUpDate(e){if(!e.leases||0===e.leases.length)return 0;let t=e.leases[0],a=t.rent_cadence||"monthly",r=new Date(e.currently_paid_up_date?e.currently_paid_up_date:e.last_payment_date?e.last_payment_date:t.lease_start_date),s=new Date,l=new Date(r),n=0;for(;l<=s;){let e=new Date(l),t=Math.floor((s.getTime()-e.getTime())/864e5);switch(t>5&&(n+=t-5),a.toLowerCase().trim()){case"weekly":l.setDate(l.getDate()+7);break;case"bi-weekly":case"biweekly":case"bi_weekly":l.setDate(l.getDate()+14);break;default:l.setMonth(l.getMonth()+1)}}return n}static getLateFeeAmount(e){switch(e.toLowerCase().trim()){case"weekly":return 10;case"bi-weekly":case"biweekly":case"bi_weekly":return 20;default:return 45}}static extractRentCadence(e){if(!e)return"monthly";let t=e.match(/Rent cadence:\s*(\w+)/i);return t?t[1]:"monthly"}static daysBetween(e,t){let a=new Date(e);return Math.ceil(Math.abs(new Date(t).getTime()-a.getTime())/864e5)}static getExpectedPaymentDate(e,t,a){let r=new Date(e);switch(a.toLowerCase().trim()){case"weekly":return new Date(r.getTime()+6048e5*t);case"bi-weekly":case"biweekly":case"bi_weekly":return new Date(r.getTime()+12096e5*t);default:let s=new Date(r);return s.setMonth(s.getMonth()+t),s}}static getLastExpectedPaymentDates(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:12,r=[],s=new Date,l=0,n=this.getExpectedPaymentDate(e,l,t);for(;n<=s&&l<2*a;)l++,n=this.getExpectedPaymentDate(e,l,t);for(let s=Math.max(0,l-a);s<l;s++)r.push(this.getExpectedPaymentDate(e,s,t));return r}static calculateLateFeesForPeriod(e,t,a,r){let s=this.getLateFeeAmount(a),l=new Date(e);l.setDate(l.getDate()-2);let n=new Date(e);n.setDate(n.getDate()+5);let i=t.filter(e=>{let t=new Date(e.date);return t>=l&&t<=n&&"completed"===e.status}),d=i.reduce((e,t)=>e+t.amount,0),c=Math.max(0,r-d),o=i.length>0?new Date(Math.max(...i.map(e=>new Date(e.date).getTime()))):null;return!o||o>n?{isLate:!0,daysLate:Math.max(0,o?this.daysBetween(n,o):this.daysBetween(n,new Date)),lateFees:c>0?s:0,totalPaid:d,outstanding:c}:{isLate:!1,daysLate:0,lateFees:0,totalPaid:d,outstanding:c}}static calculateTotalLatePayments(e,t){if(!e.leases||0===e.leases.length)return{totalLateFees:0,totalOutstanding:0,totalDue:0,latePeriods:0,payPeriods:[]};let a=e.leases[0];if(!a.lease_start_date||!a.rent)return{totalLateFees:0,totalOutstanding:0,totalDue:0,latePeriods:0,payPeriods:[]};let r=a.rent_cadence||"monthly",s=a.rent,l=this.getLastExpectedPaymentDates(a.lease_start_date,r,12),n=0,i=0,d=0,c=l.map(t=>{let a=this.calculateLateFeesForPeriod(t,e.payment_history||[],r,s);return a.isLate&&(n+=a.lateFees,i+=a.outstanding,d++),{expectedDate:t,...a}});return{totalLateFees:n,totalOutstanding:i,totalDue:n+i,latePeriods:d,payPeriods:c}}static isTenantLate(e,t){return this.calculateTotalLatePayments(e,t).totalDue>0}static async createByPropertyAddress(e){try{let t=(0,n.Ng)(),{data:a,error:r}=await t.from("RENT_properties").select("id, monthly_rent").ilike("address","%".concat(e.property_address,"%")).single();if(r)return(0,n.ql)(null,"Property not found with address: ".concat(e.property_address));let{property_address:s,...l}=e,i={...l,property_id:a.id,monthly_rent:e.monthly_rent||a.monthly_rent},{data:d,error:c}=await t.from("RENT_tenants").insert([i]).select("*, RENT_properties(name, address)").single();if(c)return(0,n.ql)(null,(0,n.Iu)(c));return(0,n.ql)(d)}catch(e){return(0,n.ql)(null,(0,n.Iu)(e))}}static async bulkCreateByPropertyAddress(e){try{(0,n.Ng)();let t=[],a=[];for(let r of e)try{let e=await this.createByPropertyAddress(r);e.success&&e.data?t.push(e.data):a.push("Failed to create tenant ".concat(r.first_name," ").concat(r.last_name,": ").concat(e.error))}catch(e){a.push("Error creating tenant ".concat(r.first_name," ").concat(r.last_name,": ").concat(e))}return(0,n.ql)({created:t,errors:a})}catch(e){return(0,n.ql)(null,(0,n.Iu)(e))}}}class d{static async getAll(){try{let e=(0,n.Ng)(),{data:t,error:a}=await e.from("RENT_leases").select("*").order("lease_start_date",{ascending:!1});if(a)return(0,n.ql)(null,(0,n.Iu)(a));return(0,n.ql)(t)}catch(e){return(0,n.ql)(null,(0,n.Iu)(e))}}static async getByPropertyId(e){try{let t=(0,n.Ng)(),{data:a,error:r}=await t.from("RENT_leases").select("*").eq("property_id",e).order("lease_start_date",{ascending:!1});if(r)return(0,n.ql)(null,(0,n.Iu)(r));return(0,n.ql)(a)}catch(e){return(0,n.ql)(null,(0,n.Iu)(e))}}static async getActiveLeasesByPropertyId(e){try{let t=(0,n.Ng)(),a=new Date().toISOString().split("T")[0],{data:r,error:s}=await t.from("RENT_leases").select("*").eq("property_id",e).lte("lease_start_date",a).gte("lease_end_date",a).order("lease_start_date",{ascending:!1});if(s)return(0,n.ql)(null,(0,n.Iu)(s));return(0,n.ql)(r)}catch(e){return(0,n.ql)(null,(0,n.Iu)(e))}}static async hasActiveLeases(e){try{let t=await this.getActiveLeasesByPropertyId(e);if(!t.success)return(0,n.ql)(!1);let a=t.data&&t.data.length>0;return(0,n.ql)(a)}catch(e){return(0,n.ql)(!1)}}static async create(e){try{let t=(0,n.Ng)(),{data:a,error:r}=await t.from("RENT_leases").insert([e]).select().single();if(r)return(0,n.ql)(null,(0,n.Iu)(r));return(0,n.ql)(a)}catch(e){return(0,n.ql)(null,(0,n.Iu)(e))}}static async update(e,t){try{let a=(0,n.Ng)(),{data:r,error:s}=await a.from("RENT_leases").update(t).eq("id",e).select().single();if(s)return(0,n.ql)(null,(0,n.Iu)(s));return(0,n.ql)(r)}catch(e){return(0,n.ql)(null,(0,n.Iu)(e))}}static async delete(e){try{let t=(0,n.Ng)(),{error:a}=await t.from("RENT_leases").delete().eq("id",e);if(a)return(0,n.ql)(null,(0,n.Iu)(a));return(0,n.ql)(!0)}catch(e){return(0,n.ql)(null,(0,n.Iu)(e))}}static async updateLeaseStatus(e){try{let t=(0,n.Ng)(),a=new Date().toISOString().split("T")[0],{data:r,error:s}=await t.from("RENT_leases").select("*").eq("id",e).single();if(s)return(0,n.ql)(null,(0,n.Iu)(s));let l="active";if(a<r.lease_start_date?l="pending":a>r.lease_end_date&&(l="expired"),r.status!==l)return await this.update(e,{status:l});return(0,n.ql)(r)}catch(e){return(0,n.ql)(null,(0,n.Iu)(e))}}static async getAllPropertiesWithLeaseStatus(){try{let e=(0,n.Ng)(),{data:t,error:a}=await e.from("RENT_leases").select("*").eq("status","active");if(a)return(0,n.ql)(null,(0,n.Iu)(a));let r=new Map;(t||[]).forEach(e=>{r.has(e.property_id)||r.set(e.property_id,[]),r.get(e.property_id).push(e)});let{data:s,error:l}=await e.from("RENT_properties").select("id");if(l)return(0,n.ql)(null,(0,n.Iu)(l));let i=(s||[]).map(e=>{let t=r.get(e.id)||[];return{property_id:e.id,has_active_lease:t.length>0,active_lease_count:t.length,active_leases:t}});return(0,n.ql)(i)}catch(e){return(0,n.ql)(null,(0,n.Iu)(e))}}}class c{static async getAll(e){try{let t=(0,n.Ng)().from("RENT_properties").select("\n          id,\n          name,\n          address,\n          city,\n          state,\n          zip_code,\n          property_type,\n          status,\n          bedrooms,\n          bathrooms,\n          square_feet,\n          year_built,\n          purchase_price,\n          purchase_payment,\n          purchase_date,\n          current_value,\n          monthly_rent,\n          is_for_rent,\n          is_for_sale,\n          insurance_premium,\n          property_tax,\n          notes,\n          created_at,\n          updated_at\n        ").order("created_at",{ascending:!1});(null==e?void 0:e.is_for_rent)!==void 0&&(t=t.eq("is_for_rent",e.is_for_rent)),(null==e?void 0:e.is_for_sale)!==void 0&&(t=t.eq("is_for_sale",e.is_for_sale)),(null==e?void 0:e.city)&&(t=t.eq("city",e.city)),(null==e?void 0:e.state)&&(t=t.eq("state",e.state));let{data:a,error:r}=await t;if(r)return console.error("PropertiesService.getAll error:",r),(0,n.ql)(null,(0,n.Iu)(r));let s=await d.getAllPropertiesWithLeaseStatus();if(!s.success||!s.data)return(0,n.ql)(a);let l=new Map(s.data.map(e=>[e.property_id,e])),i=a.map(e=>{let t=l.get(e.id),a=(null==t?void 0:t.has_active_lease)||!1;return{...e,status:a?"rented":"empty",active_leases:(null==t?void 0:t.active_leases)||[],active_lease_count:(null==t?void 0:t.active_lease_count)||0}});return(0,n.ql)(i)}catch(e){return console.error("PropertiesService.getAll exception:",e),(0,n.ql)(null,(0,n.Iu)(e))}}static async getById(e){try{let t=(0,n.Ng)(),{data:a,error:r}=await t.from("RENT_properties").select("*").eq("id",e).single();if(r)return(0,n.ql)(null,(0,n.Iu)(r));let{data:s}=await t.from("RENT_tenants").select("*").eq("property_id",e).eq("is_active",!0),l={...a,tenants:s||[]};return(0,n.ql)(l)}catch(e){return(0,n.ql)(null,(0,n.Iu)(e))}}static async create(e){try{let t=(0,n.Ng)(),{data:a,error:r}=await t.from("RENT_properties").insert([e]).select().single();if(r)return(0,n.ql)(null,(0,n.Iu)(r));return(0,n.ql)(a)}catch(e){return(0,n.ql)(null,(0,n.Iu)(e))}}static async update(e,t){try{let a=(0,n.Ng)(),{data:r,error:s}=await a.from("RENT_properties").update(t).eq("id",e).select().single();if(s)return(0,n.ql)(null,(0,n.Iu)(s));return(0,n.ql)(r)}catch(e){return(0,n.ql)(null,(0,n.Iu)(e))}}static async delete(e){try{let t=(0,n.Ng)(),{error:a}=await t.from("RENT_properties").delete().eq("id",e);if(a)return(0,n.ql)(null,(0,n.Iu)(a));return(0,n.ql)(!0)}catch(e){return(0,n.ql)(null,(0,n.Iu)(e))}}static async getPaginated(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,a=arguments.length>2?arguments[2]:void 0;try{let r=(0,n.Ng)(),s=(e-1)*t,l=r.from("RENT_properties").select("*",{count:"exact"}).order("created_at",{ascending:!1}).range(s,s+t-1);(null==a?void 0:a.is_for_rent)!==void 0&&(l=l.eq("is_for_rent",a.is_for_rent)),(null==a?void 0:a.is_for_sale)!==void 0&&(l=l.eq("is_for_sale",a.is_for_sale)),(null==a?void 0:a.city)&&(l=l.eq("city",a.city)),(null==a?void 0:a.state)&&(l=l.eq("state",a.state));let{data:i,error:d,count:c}=await l;if(d)return(0,n.ql)(null,(0,n.Iu)(d));let o=await Promise.all(i.map(async e=>{let{data:t}=await r.from("RENT_tenants").select("*").eq("property_id",e.id);return{...e,tenants:t||[]}})),u=c||0;return(0,n.ql)({data:o,total:u,page:e,limit:t,hasMore:s+t<u})}catch(e){return(0,n.ql)(null,(0,n.Iu)(e))}}static async search(e){try{let t=(0,n.Ng)(),{data:a,error:r}=await t.from("RENT_properties").select("*").or("name.ilike.%".concat(e,"%,address.ilike.%").concat(e,"%,city.ilike.%").concat(e,"%")).order("created_at",{ascending:!1});if(r)return(0,n.ql)(null,(0,n.Iu)(r));let s=await Promise.all(a.map(async e=>{let{data:a}=await t.from("RENT_tenants").select("*").eq("property_id",e.id);return{...e,tenants:a||[]}}));return(0,n.ql)(s)}catch(e){return(0,n.ql)(null,(0,n.Iu)(e))}}static async getAvailableForRent(){return this.getAll({is_for_rent:!0})}static async getAvailableForSale(){return this.getAll({is_for_sale:!0})}}var o=a(9369);function u(e){let{tenant:t,onClose:a,onSave:l}=e,[n,i]=(0,s.useState)([]),[d,c]=(0,s.useState)(!0);(0,s.useEffect)(()=>{var e;(null===(e=t.late_payment_info)||void 0===e?void 0:e.payPeriods)&&i(t.late_payment_info.payPeriods.map(e=>({...e,editedLateFees:e.lateFees,editedPaymentDate:"",editedPaymentAmount:0}))),c(!1)},[t]);let o=(e,t)=>{let a=[...n];a[e].editedLateFees=Math.max(0,t),i(a)},u=(e,t)=>{let a=[...n];a[e].editedPaymentDate=t,i(a)},m=(e,t)=>{let a=[...n];a[e].editedPaymentAmount=Math.max(0,t),i(a)},p=()=>n.reduce((e,t)=>{let a=t.editedLateFees||t.lateFees,r=t.editedPaymentAmount||0;return e+a+Math.max(0,t.outstanding-r)},0);return d?(0,r.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,r.jsx)("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-primary-600"})}):(0,r.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-xl max-w-6xl w-full max-h-[90vh] overflow-hidden",children:[(0,r.jsxs)("div",{className:"px-6 py-4 border-b border-gray-200 flex justify-between items-center",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("h2",{className:"text-xl font-semibold text-gray-900",children:["Late Payment Details - ",t.first_name," ",t.last_name]}),(0,r.jsx)("p",{className:"text-sm text-gray-600",children:t.property_address})]}),(0,r.jsx)("button",{onClick:a,className:"text-gray-400 hover:text-gray-600 text-2xl font-bold",children:"\xd7"})]}),(0,r.jsxs)("div",{className:"px-6 py-4 overflow-y-auto max-h-[calc(90vh-200px)]",children:[(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[(0,r.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg",children:[(0,r.jsx)("h3",{className:"text-sm font-medium text-gray-500",children:"Monthly Rent"}),(0,r.jsxs)("p",{className:"text-lg font-semibold text-gray-900",children:["$",t.rent.toLocaleString()]})]}),(0,r.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg",children:[(0,r.jsx)("h3",{className:"text-sm font-medium text-gray-500",children:"Current Total Owed"}),(0,r.jsxs)("p",{className:"text-lg font-semibold text-red-600",children:["$",t.total_owed.toLocaleString()]})]}),(0,r.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg",children:[(0,r.jsx)("h3",{className:"text-sm font-medium text-gray-500",children:"Updated Total"}),(0,r.jsxs)("p",{className:"text-lg font-semibold text-blue-600",children:["$",p().toLocaleString()]})]}),(0,r.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg",children:[(0,r.jsx)("h3",{className:"text-sm font-medium text-gray-500",children:"Late Periods"}),(0,r.jsx)("p",{className:"text-lg font-semibold text-gray-900",children:t.late_periods})]})]}),(0,r.jsxs)("div",{className:"bg-white border border-gray-200 rounded-lg overflow-hidden",children:[(0,r.jsxs)("div",{className:"px-4 py-3 bg-gray-50 border-b border-gray-200",children:[(0,r.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"Payment Periods"}),(0,r.jsx)("p",{className:"text-sm text-gray-600",children:"Edit late fees and record payments for each period"})]}),(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,r.jsx)("thead",{className:"bg-gray-50",children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Expected Date"}),(0,r.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Days Late"}),(0,r.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Late Fees"}),(0,r.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Outstanding"}),(0,r.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Payment Date"}),(0,r.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Payment Amount"}),(0,r.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"New Outstanding"})]})}),(0,r.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:n.map((e,t)=>(0,r.jsxs)("tr",{className:e.isLate?"bg-red-50":"bg-green-50",children:[(0,r.jsx)("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-900",children:e.expectedDate.toLocaleDateString()}),(0,r.jsx)("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-900",children:e.daysLate}),(0,r.jsx)("td",{className:"px-4 py-3 whitespace-nowrap",children:(0,r.jsx)("input",{type:"number",min:"0",step:"0.01",value:e.editedLateFees||e.lateFees,onChange:e=>o(t,parseFloat(e.target.value)||0),className:"w-20 px-2 py-1 border border-gray-300 rounded text-sm"})}),(0,r.jsxs)("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-900",children:["$",e.outstanding.toLocaleString()]}),(0,r.jsx)("td",{className:"px-4 py-3 whitespace-nowrap",children:(0,r.jsx)("input",{type:"date",value:e.editedPaymentDate||"",onChange:e=>u(t,e.target.value),className:"px-2 py-1 border border-gray-300 rounded text-sm"})}),(0,r.jsx)("td",{className:"px-4 py-3 whitespace-nowrap",children:(0,r.jsx)("input",{type:"number",min:"0",step:"0.01",value:e.editedPaymentAmount||0,onChange:e=>m(t,parseFloat(e.target.value)||0),className:"w-24 px-2 py-1 border border-gray-300 rounded text-sm"})}),(0,r.jsxs)("td",{className:"px-4 py-3 whitespace-nowrap text-sm font-semibold",children:["$",Math.max(0,e.outstanding-(e.editedPaymentAmount||0)).toLocaleString()]})]},t))})]})})]}),(0,r.jsxs)("div",{className:"mt-6 bg-blue-50 p-4 rounded-lg",children:[(0,r.jsx)("h3",{className:"text-lg font-medium text-blue-900 mb-2",children:"Summary of Changes"}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-blue-700",children:"Original Total:"}),(0,r.jsxs)("span",{className:"ml-2 font-semibold",children:["$",t.total_owed.toLocaleString()]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-blue-700",children:"Updated Total:"}),(0,r.jsxs)("span",{className:"ml-2 font-semibold",children:["$",p().toLocaleString()]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-blue-700",children:"Difference:"}),(0,r.jsxs)("span",{className:"ml-2 font-semibold ".concat(p()<t.total_owed?"text-green-600":"text-red-600"),children:["$",(p()-t.total_owed).toLocaleString()]})]})]})]})]}),(0,r.jsxs)("div",{className:"px-6 py-4 border-t border-gray-200 flex justify-end space-x-3",children:[(0,r.jsx)("button",{onClick:a,className:"px-4 py-2 text-gray-700 bg-gray-200 rounded-lg hover:bg-gray-300 transition-colors",children:"Cancel"}),(0,r.jsx)("button",{onClick:()=>{l({tenantId:t.id,paymentPeriods:n.map(e=>({expectedDate:e.expectedDate,originalLateFees:e.lateFees,updatedLateFees:e.editedLateFees,originalOutstanding:e.outstanding,paymentDate:e.editedPaymentDate,paymentAmount:e.editedPaymentAmount,newOutstanding:Math.max(0,e.outstanding-(e.editedPaymentAmount||0))})),totalUpdated:p()})},className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Save Changes"})]})]})})}function m(){let e=(0,l.useRouter)(),[t,a]=(0,s.useState)([]),[n,d]=(0,s.useState)(!0),[m,p]=(0,s.useState)(null),[y,_]=(0,s.useState)(!1);(0,s.useEffect)(()=>{h()},[]);let h=async()=>{try{d(!0);let e=(await i.getAll()).data,t=(await c.getAll()).data;if(!e||!t){console.error("Failed to load data");return}let r=[];e.forEach(e=>{try{let a=t.find(t=>t.id===e.property_id);if(!a)return;let s=e.leases&&e.leases.length>0?e.leases[0]:null;if(!s||!s.lease_start_date)return;let l={...e,lease_start_date:s.lease_start_date},n={...a,notes:a.notes||""};if((0,o.mq)(l,n)){let t=(0,o.c1)(l,n);r.push({id:e.id,first_name:e.first_name,last_name:e.last_name,property_id:e.property_id,property_name:a.name,property_address:a.address,rent:a.monthly_rent||0,total_owed:t.totalDue,late_periods:t.latePeriods,lease_start_date:s.lease_start_date,rent_cadence:s.rent_cadence||"monthly",late_payment_info:t})}}catch(t){console.error("Error processing tenant:",e.first_name,e.last_name,t)}}),r.sort((e,t)=>{let a=e=>{switch(e.toLowerCase().trim()){case"weekly":return 1;case"bi-weekly":case"biweekly":case"bi_weekly":return 2;default:return 3}},r=a(e.rent_cadence),s=a(t.rent_cadence);return r!==s?r-s:t.total_owed-e.total_owed}),a(r)}catch(e){console.error("Error loading late payments:",e)}finally{d(!1)}},g=e=>{p(e),_(!0)},x=()=>{_(!1),p(null)},f=async e=>{await h(),x()};return n?(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,r.jsx)("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-primary-600"})}):(0,r.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,r.jsx)("header",{className:"bg-white shadow-sm border-b border-gray-200",children:(0,r.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,r.jsxs)("div",{className:"flex justify-between items-center py-6",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Late Payments"}),(0,r.jsx)("p",{className:"text-gray-600",children:"Manage tenants with outstanding balances"})]}),(0,r.jsx)("div",{className:"flex items-center space-x-4",children:(0,r.jsx)("button",{onClick:()=>e.push("/"),className:"bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700 transition-colors",children:"Back to Dashboard"})})]})})}),(0,r.jsxs)("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8",children:[(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,r.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"Total Late Tenants"}),(0,r.jsx)("p",{className:"text-3xl font-bold text-red-600",children:t.length})]}),(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,r.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"Total Outstanding"}),(0,r.jsxs)("p",{className:"text-3xl font-bold text-red-600",children:["$",t.reduce((e,t)=>e+t.total_owed,0).toLocaleString()]})]}),(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,r.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"Average Per Tenant"}),(0,r.jsxs)("p",{className:"text-3xl font-bold text-red-600",children:["$",t.length>0?(t.reduce((e,t)=>e+t.total_owed,0)/t.length).toFixed(0):0]})]}),(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,r.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"Total Late Periods"}),(0,r.jsx)("p",{className:"text-3xl font-bold text-red-600",children:t.reduce((e,t)=>e+t.late_periods,0)})]})]}),(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:[(0,r.jsxs)("div",{className:"px-6 py-4 border-b border-gray-200",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:"Late Payment Details"}),(0,r.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Sorted by payment cadence: Weekly (1) → Bi-weekly (2) → Monthly (3), then by total amount owed"})]}),(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,r.jsx)("thead",{className:"bg-gray-50",children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Tenant"}),(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Property Address"}),(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Rent Cadence"}),(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Rent"}),(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Total Owed"}),(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Late Periods"}),(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),(0,r.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:t.map(e=>(0,r.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,r.jsxs)("div",{className:"text-sm font-medium text-gray-900",children:[e.first_name," ",e.last_name]})}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,r.jsx)("div",{className:"text-sm text-gray-900",children:e.property_address})}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)("span",{className:"text-sm text-gray-600 capitalize",children:e.rent_cadence}),(0,r.jsx)("span",{className:"inline-flex items-center px-1.5 py-0.5 rounded-full text-xs font-medium ".concat("weekly"===e.rent_cadence.toLowerCase()?"bg-red-100 text-red-800":"bi-weekly"===e.rent_cadence.toLowerCase()||"biweekly"===e.rent_cadence.toLowerCase()||"bi_weekly"===e.rent_cadence.toLowerCase()?"bg-yellow-100 text-yellow-800":"bg-blue-100 text-blue-800"),children:"weekly"===e.rent_cadence.toLowerCase()?"1":"bi-weekly"===e.rent_cadence.toLowerCase()||"biweekly"===e.rent_cadence.toLowerCase()||"bi_weekly"===e.rent_cadence.toLowerCase()?"2":"3"})]})}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,r.jsxs)("div",{className:"text-sm text-gray-900",children:["$",e.rent.toLocaleString()]})}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,r.jsxs)("div",{className:"text-sm font-semibold text-red-600",children:["$",e.total_owed.toLocaleString()]})}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,r.jsx)("div",{className:"text-sm text-gray-900",children:e.late_periods})}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:(0,r.jsx)("button",{onClick:()=>g(e),className:"text-indigo-600 hover:text-indigo-900 bg-indigo-100 hover:bg-indigo-200 px-3 py-1 rounded-md transition-colors",children:"Details"})})]},e.id))})]})}),0===t.length&&(0,r.jsx)("div",{className:"text-center py-12",children:(0,r.jsx)("p",{className:"text-gray-500 text-lg",children:"No late payments found"})})]})]}),y&&m&&(0,r.jsx)(u,{tenant:m,onClose:x,onSave:f})]})}},9369:function(e,t,a){"use strict";function r(e,t){if(!e||!t)return e||0;switch(t.toLowerCase().trim()){case"weekly":return 4.33*e;case"bi-weekly":case"biweekly":case"bi_weekly":return 2.17*e;default:return e}}function s(e){if(!e)return"monthly";let t=e.match(/Rent cadence:\s*(\w+)/i);return t?t[1]:"monthly"}function l(e,t){if(!e)return"$0";let a=(null==t?void 0:t.toLowerCase().trim())||"monthly";return"$".concat(e.toLocaleString(),"/").concat(a)}function n(e,t,a){let r;let s=new Date(e);switch(a.toLowerCase().trim()){case"weekly":r=new Date(s.getTime()+6048e5*t);break;case"bi-weekly":case"biweekly":case"bi_weekly":r=new Date(s.getTime()+12096e5*t);break;default:(r=new Date(s)).setMonth(r.getMonth()+t)}return r}function i(e,t){if(console.log("calculateTotalLatePayments: Starting calculation for",e.first_name,e.last_name),!e||!t||!e.lease_start_date||!(null==t?void 0:t.monthly_rent))return console.log("calculateTotalLatePayments: Missing required data - tenant:",!!e,"property:",!!t,"lease_start_date:",null==e?void 0:e.lease_start_date,"monthly_rent:",null==t?void 0:t.monthly_rent),{totalLateFees:0,totalOutstanding:0,totalDue:0,latePeriods:0,payPeriods:[]};try{let a=s(t.notes),r=t.monthly_rent;console.log("calculateTotalLatePayments: Cadence:",a,"Monthly rent:",r);let l=r;"weekly"===a?l=r/4.33:("bi-weekly"===a||"biweekly"===a||"bi_weekly"===a)&&(l=r/2.17),console.log("Tenant calculation - Cadence:",a,"Monthly rent:",r,"Period rent:",l);let i=function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:12,r=[],s=new Date,l=0,i=n(e,0,t),d=0,c=3*a;for(;i<=s&&l<2*a&&d<c;)i=n(e,++l,t),d++;if(d>=c)return console.error("getLastExpectedPaymentDates: Safety limit reached, possible infinite loop detected"),[];l=Math.max(0,l-1);for(let i=Math.max(0,l-a+1);i<=l;i++){let a=n(e,i,t);a<=s&&r.push(a)}return r}(e.lease_start_date,a,12),d=0,c=0,o=0,u=i.map(t=>{let r=function(e,t,a,r){let s=function(e){switch(e.toLowerCase().trim()){case"weekly":return 10;case"bi-weekly":case"biweekly":case"bi_weekly":return 20;default:return 45}}(a),l=e.toISOString().split("T")[0];t&&Array.isArray(t)||(t=[]);let n=new Date(e);n.setDate(n.getDate()-2);let i=new Date(e);i.setDate(i.getDate()+5);let d=t.filter(e=>{let t=new Date(e.date);return t>=n&&t<=i&&"completed"===e.status}),c=d.reduce((e,t)=>e+t.amount,0),o=Math.max(0,r-c),u=new Date,m=0===d.length&&u>i;return(m&&console.log("LATE PERIOD:",{expectedDate:l,periodEnd:i.toISOString().split("T")[0],today:u.toISOString().split("T")[0],outstanding:o,lateFee:o>0?s:0}),m)?{isLate:!0,daysLate:Math.max(0,function(e,t){let a=new Date(e);return Math.ceil(Math.abs(new Date(t).getTime()-a.getTime())/864e5)}(i,u)),lateFees:o>0?s:0,totalPaid:c,outstanding:o}:{isLate:!1,daysLate:0,lateFees:0,totalPaid:c,outstanding:o}}(t,e.payment_history,a,l);return r.isLate&&(d+=r.lateFees,c+=r.outstanding,o++),{expectedDate:t,...r}}),m={totalLateFees:d,totalOutstanding:c,totalDue:d+c,latePeriods:o,payPeriods:u};return console.log("calculateTotalLatePayments: Final result for",e.first_name,e.last_name,":",m),m}catch(e){return console.error("Error calculating late payments:",e),{totalLateFees:0,totalOutstanding:0,totalDue:0,latePeriods:0,payPeriods:[]}}}function d(e,t){try{if(!e||!t)return console.log("isTenantLate: Missing tenant or property data"),!1;console.log("isTenantLate: Starting check for tenant",e.first_name,e.last_name),console.log("isTenantLate: Tenant lease_start_date:",e.lease_start_date),console.log("isTenantLate: Property monthly_rent:",t.monthly_rent);let a=i(e,t),r=a.totalDue>0;return console.log("isTenantLate: Result - Total due:",a.totalDue,"Is late:",r),r}catch(e){return console.error("Error checking if tenant is late:",e),!1}}a.d(t,{GN:function(){return r},S6:function(){return s},c1:function(){return i},eP:function(){return l},mq:function(){return d}})},1695:function(e,t,a){"use strict";var r=a(1219);a.o(r,"useRouter")&&a.d(t,{useRouter:function(){return r.useRouter}}),a.o(r,"useSearchParams")&&a.d(t,{useSearchParams:function(){return r.useSearchParams}})},2346:function(e,t,a){"use strict";a.d(t,{Iu:function(){return c},Ng:function(){return d},ql:function(){return o}});var r=a(3334);let s="https://gnisgfojzrrnidizrycj.supabase.co",l="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImduaXNnZm9qenJybmlkaXpyeWNqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTE3NjgyMDMsImV4cCI6MjA2NzM0NDIwM30.jLRIt4mqNa-6rnWudT_ciCvfPC0i0WlWFrCgC7NbhYM",n=null,i=!1;function d(){if(n)return n;if(i)throw Error("Supabase client is already being initialized");try{return i=!0,n=function(){if(!s||!l)throw Error("Supabase configuration is missing. Please check your environment variables.");return(0,r.createClient)(s,l,{auth:{autoRefreshToken:!1,persistSession:!1,detectSessionInUrl:!1,storageKey:"rental-app-auth"},global:{headers:{"X-Client-Info":"rental-app-web"}}})}()}finally{i=!1}}function c(e){return(null==e?void 0:e.message)?e.message:(null==e?void 0:e.error_description)?e.error_description:"An unexpected error occurred"}function o(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return{data:e,error:t,success:!t}}(()=>{try{return d()}catch(e){return console.error("Failed to get Supabase client:",e),null}})()}},function(e){e.O(0,[334,293,528,744],function(){return e(e.s=6996)}),_N_E=e.O()}]);