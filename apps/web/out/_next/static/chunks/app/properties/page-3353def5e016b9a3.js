(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[664],{8978:function(e,t,s){Promise.resolve().then(s.bind(s,1369))},1369:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return D}});var r=s(7573),a=s(7653),l=s(1695),n=s(6286),i=s(3172),c=s(5731),o=s(6295),d=s(9776),m=s(1797),u=s(6548),x=s(5265),p=s(9026),h=s(997),g=s(4452),y=s(3727),f=s(2548),b=s(269),j=s(3989),v=s(205);function N(e){let{propertyId:t,propertyName:s,onClose:l,onSuccess:i}=e,[c,o]=(0,a.useState)([]),[d,u]=(0,a.useState)(!0),[x,h]=(0,a.useState)(null),[g,y]=(0,a.useState)(null);(0,a.useEffect)(()=>{N()},[]);let N=async()=>{try{u(!0);let e=await n.TenantsService.getAll();e.success&&e.data?o(e.data):f.ZP.error("Failed to load tenants")}catch(e){f.ZP.error("Error loading tenants")}finally{u(!1)}},w=async e=>{try{h(e);let s=await n.TenantsService.update(e,{property_id:t});if(s.success){let e=await n.PropertiesService.getById(t);if(e.success&&e.data){let s=e.data;"empty"===s.status&&await n.PropertiesService.update(t,{status:"rented",notes:"".concat(s.notes||"","\n\n[").concat(new Date().toLocaleDateString(),"] Property status changed to 'rented' - tenant linked.")})}f.ZP.success("Tenant linked to property successfully! Property status updated to rented."),i(),N()}else f.ZP.error(s.error||"Failed to link tenant")}catch(e){f.ZP.error("Error linking tenant")}finally{h(null)}},_=async e=>{try{y(e);let s=await n.TenantsService.update(e,{property_id:void 0});if(s.success){let s=c.filter(s=>s.property_id===t&&s.id!==e);if(0===s.length){let e=await n.PropertiesService.getById(t);if(e.success&&e.data){let s=e.data;await n.PropertiesService.update(t,{status:"empty",notes:"".concat(s.notes||"","\n\n[").concat(new Date().toLocaleDateString(),"] Property status changed to 'empty' - all tenants unlinked.")})}}f.ZP.success("Tenant unlinked from property successfully!"),i(),N()}else f.ZP.error(s.error||"Failed to unlink tenant")}catch(e){f.ZP.error("Error unlinking tenant")}finally{y(null)}},k=c.filter(e=>e.property_id===t),P=c.filter(e=>!e.property_id);return d?(0,r.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,r.jsx)("div",{className:"bg-white rounded-lg shadow-xl p-6",children:(0,r.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600 mx-auto"})})}):(0,r.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:"Link Tenants to Property"}),(0,r.jsx)("p",{className:"text-gray-600 mt-1",children:s})]}),(0,r.jsx)("button",{onClick:l,className:"text-gray-400 hover:text-gray-600",children:(0,r.jsx)(b.Z,{className:"w-6 h-6"})})]}),(0,r.jsxs)("div",{className:"p-6",children:[(0,r.jsxs)("div",{className:"mb-8",children:[(0,r.jsxs)("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[(0,r.jsx)(j.Z,{className:"w-5 h-5 mr-2"}),"Currently Linked Tenants (",k.length,")"]}),0===k.length?(0,r.jsxs)("div",{className:"text-center py-8 bg-gray-50 rounded-lg",children:[(0,r.jsx)(j.Z,{className:"w-12 h-12 text-gray-400 mx-auto mb-2"}),(0,r.jsx)("p",{className:"text-gray-600",children:"No tenants currently linked to this property"})]}):(0,r.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:k.map(e=>(0,r.jsx)("div",{className:"border border-gray-200 rounded-lg p-4",children:(0,r.jsxs)("div",{className:"flex justify-between items-start mb-2",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("h4",{className:"font-medium text-gray-900",children:[e.first_name," ",e.last_name]}),e.email&&(0,r.jsx)("p",{className:"text-sm text-gray-600",children:e.email}),e.phone&&(0,r.jsx)("p",{className:"text-sm text-gray-600",children:e.phone})]}),(0,r.jsx)("button",{onClick:()=>_(e.id),disabled:g===e.id,className:"btn btn-sm btn-danger",children:g===e.id?(0,r.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(v.Z,{className:"w-4 h-4 mr-1"}),"Unlink"]})})]})},e.id))})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[(0,r.jsx)(m.Z,{className:"w-5 h-5 mr-2"}),"Available Tenants (",P.length,")"]}),0===P.length?(0,r.jsxs)("div",{className:"text-center py-8 bg-gray-50 rounded-lg",children:[(0,r.jsx)(m.Z,{className:"w-12 h-12 text-gray-400 mx-auto mb-2"}),(0,r.jsx)("p",{className:"text-gray-600",children:"All tenants are already linked to properties"})]}):(0,r.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:P.map(e=>(0,r.jsx)("div",{className:"border border-gray-200 rounded-lg p-4",children:(0,r.jsxs)("div",{className:"flex justify-between items-start mb-2",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("h4",{className:"font-medium text-gray-900",children:[e.first_name," ",e.last_name]}),e.email&&(0,r.jsx)("p",{className:"text-sm text-gray-600",children:e.email}),e.phone&&(0,r.jsx)("p",{className:"text-sm text-gray-600",children:e.phone})]}),(0,r.jsx)("button",{onClick:()=>w(e.id),disabled:x===e.id,className:"btn btn-sm btn-primary",children:x===e.id?(0,r.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(p.Z,{className:"w-4 h-4 mr-1"}),"Link"]})})]})},e.id))})]})]}),(0,r.jsx)("div",{className:"flex justify-end p-6 border-t border-gray-200",children:(0,r.jsx)("button",{onClick:l,className:"btn btn-secondary",children:"Close"})})]})})}let w=(0,s(4070).default)(()=>Promise.all([s.e(649),s.e(183),s.e(137)]).then(s.bind(s,9137)),{loadableGenerated:{webpack:()=>[9137]},ssr:!1,loading:()=>(0,r.jsx)("div",{className:"bg-gray-100 rounded-lg flex items-center justify-center",style:{height:"400px"},children:(0,r.jsx)("div",{className:"text-center text-gray-500",children:(0,r.jsx)("div",{className:"text-lg font-medium mb-2",children:"Loading Map..."})})})});function _(e){let{properties:t,height:s="400px"}=e,[l,n]=(0,a.useState)(!1);if((0,a.useEffect)(()=>{n(!0)},[]),!l)return(0,r.jsx)("div",{className:"bg-gray-100 rounded-lg flex items-center justify-center",style:{height:s},children:(0,r.jsx)("div",{className:"text-center text-gray-500",children:(0,r.jsx)("div",{className:"text-lg font-medium mb-2",children:"Loading Map..."})})});let i=t.filter(e=>e.latitude&&e.longitude);return 0===i.length?(0,r.jsx)("div",{className:"bg-gray-100 rounded-lg flex items-center justify-center",style:{height:s},children:(0,r.jsxs)("div",{className:"text-center text-gray-500",children:[(0,r.jsx)("div",{className:"text-lg font-medium mb-2",children:"No Properties with Location Data"}),(0,r.jsx)("div",{className:"text-sm",children:"Add latitude and longitude coordinates to your properties to see them on the map"})]})}):(0,r.jsx)("div",{className:"rounded-lg overflow-hidden border border-gray-200",style:{height:s},children:(0,r.jsx)(w,{properties:i})})}var k=s(3896),P=s(909),L=s(6065),S=s(4859);function C(e){let{properties:t,onPropertiesUpdated:s}=e,[l,i]=(0,a.useState)(!1),[c,o]=(0,a.useState)(0),[d,m]=(0,a.useState)({success:0,failed:0,skipped:0,errors:[]}),u=t.filter(e=>!e.latitude||!e.longitude),x=async e=>{if(!e.address||!e.city||!e.state)return{success:!1,error:"Missing address information"};try{let t="".concat(e.address,", ").concat(e.city,", ").concat(e.state," ").concat(e.zip_code||"").trim(),s=S.env.NEXT_PUBLIC_GOOGLE_MAPS_API_KEY;if(s&&"YOUR_GOOGLE_MAPS_API_KEY_HERE"!==s){let r=await fetch("https://maps.googleapis.com/maps/api/geocode/json?address=".concat(encodeURIComponent(t),"&key=").concat(s));if(!r.ok)return{success:!1,error:"Geocoding service error"};let a=await r.json();if("OK"===a.status&&a.results&&a.results.length>0){let t=a.results[0].geometry.location,s=t.lat,r=t.lng;if((await n.PropertiesService.update(e.id,{latitude:s,longitude:r})).success)return{success:!0};return{success:!1,error:"Failed to update property"}}if("ZERO_RESULTS"===a.status)return{success:!1,error:"Address not found"};if("OVER_QUERY_LIMIT"===a.status)return{success:!1,error:"API quota exceeded"};return{success:!1,error:"Geocoding error: ".concat(a.status)}}{let s=await fetch("https://nominatim.openstreetmap.org/search?format=json&q=".concat(encodeURIComponent(t),"&limit=1&addressdetails=1"));if(!s.ok)return{success:!1,error:"Geocoding service error"};let r=await s.json();if(!r||!(r.length>0))return{success:!1,error:"Address not found"};{let t=r[0],s=parseFloat(t.lat),a=parseFloat(t.lon);if((await n.PropertiesService.update(e.id,{latitude:s,longitude:a})).success)return{success:!0};return{success:!1,error:"Failed to update property"}}}}catch(e){return{success:!1,error:"Network error"}}},p=async()=>{if(0===u.length){(0,f.ZP)("All properties already have coordinates!");return}i(!0),o(0),m({success:0,failed:0,skipped:0,errors:[]});for(let e=0;e<u.length;e++){let t=u[e];o((e+1)/u.length*100);let s=await x(t);s.success?m(e=>({...e,success:e.success+1})):m(e=>({...e,failed:e.failed+1,errors:[...e.errors,"".concat(t.name,": ").concat(s.error)]})),await new Promise(e=>setTimeout(e,1e3))}i(!1),d.success>0&&(f.ZP.success("Successfully geocoded ".concat(d.success," properties!")),s()),d.failed>0&&f.ZP.error("Failed to geocode ".concat(d.failed," properties"))};return 0===u.length?(0,r.jsx)("div",{className:"p-4 bg-green-50 rounded-lg border border-green-200",children:(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)(k.Z,{className:"w-5 h-5 text-green-600 mr-2"}),(0,r.jsx)("span",{className:"text-green-800 font-medium",children:"All properties have coordinates!"})]})}):(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"p-4 bg-blue-50 rounded-lg border border-blue-200",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,r.jsx)("h3",{className:"text-sm font-medium text-blue-900",children:"Bulk Geocoding"}),(0,r.jsxs)("span",{className:"text-xs text-blue-600",children:[u.length," properties need coordinates"]})]}),(0,r.jsx)("p",{className:"text-sm text-blue-700 mb-3",children:"Automatically convert addresses to coordinates for all properties without location data."}),(0,r.jsx)("button",{onClick:p,disabled:l,className:"btn btn-primary text-sm w-full",children:l?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(P.Z,{className:"w-4 h-4 mr-2 animate-spin"}),"Geocoding Properties... (",Math.round(c),"%)"]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(g.Z,{className:"w-4 h-4 mr-2"}),"Geocode ",u.length," Properties"]})}),l&&(0,r.jsx)("div",{className:"mt-3",children:(0,r.jsx)("div",{className:"w-full bg-blue-200 rounded-full h-2",children:(0,r.jsx)("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:"".concat(c,"%")}})})}),!l&&(d.success>0||d.failed>0)&&(0,r.jsxs)("div",{className:"mt-3 space-y-2",children:[(0,r.jsxs)("div",{className:"flex items-center text-sm",children:[(0,r.jsx)(k.Z,{className:"w-4 h-4 text-green-600 mr-2"}),(0,r.jsxs)("span",{className:"text-green-700",children:[d.success," properties updated"]})]}),d.failed>0&&(0,r.jsxs)("div",{className:"flex items-center text-sm",children:[(0,r.jsx)(L.Z,{className:"w-4 h-4 text-red-600 mr-2"}),(0,r.jsxs)("span",{className:"text-red-700",children:[d.failed," properties failed"]})]})]})]}),d.errors.length>0&&(0,r.jsxs)("div",{className:"p-3 bg-red-50 rounded-lg border border-red-200",children:[(0,r.jsx)("h4",{className:"text-sm font-medium text-red-900 mb-2",children:"Errors:"}),(0,r.jsx)("div",{className:"space-y-1 max-h-32 overflow-y-auto",children:d.errors.map((e,t)=>(0,r.jsx)("div",{className:"text-xs text-red-700",children:e},t))})]})]})}var Z=s(9369);function D(){let e=(0,l.useRouter)(),[t,s]=(0,a.useState)([]),[b,j]=(0,a.useState)(!0),[v,w]=(0,a.useState)(""),[k,P]=(0,a.useState)("all"),[L,S]=(0,a.useState)(!1),[D,E]=(0,a.useState)(null),[T,A]=(0,a.useState)("list"),[F,M]=(0,a.useState)("name"),[O,I]=(0,a.useState)("asc");(0,a.useEffect)(()=>{R()},[]);let R=async()=>{try{j(!0);let e=await n.PropertiesService.getAll();e.success&&e.data?(console.log("✅ Properties loaded:",e.data),s(e.data)):(console.error("❌ Failed to load properties:",e.error),f.ZP.error("Failed to load properties"))}catch(e){console.error("\uD83D\uDCA5 Error loading properties:",e),f.ZP.error("Error loading properties")}finally{j(!1)}},G=(0,a.useMemo)(()=>t.length?[...t].sort((e,t)=>{var s,r,a,l,n,i,c,o,d,m,u,x;let p,h;switch(F){case"name":p=(null===(s=e.name)||void 0===s?void 0:s.toLowerCase())||"",h=(null===(r=t.name)||void 0===r?void 0:r.toLowerCase())||"";break;case"status":p=(null===(a=e.status)||void 0===a?void 0:a.toLowerCase())||"",h=(null===(l=t.status)||void 0===l?void 0:l.toLowerCase())||"";break;case"rent":p=(null===(i=e.active_leases)||void 0===i?void 0:null===(n=i[0])||void 0===n?void 0:n.rent)||e.monthly_rent||0,h=(null===(o=t.active_leases)||void 0===o?void 0:null===(c=o[0])||void 0===c?void 0:c.rent)||t.monthly_rent||0;break;case"address":p=(null===(d=e.address)||void 0===d?void 0:d.toLowerCase())||"",h=(null===(m=t.address)||void 0===m?void 0:m.toLowerCase())||"";break;case"premium":p=e.insurance_premium||0,h=t.insurance_premium||0;break;case"type":p=(null===(u=e.property_type)||void 0===u?void 0:u.toLowerCase())||"",h=(null===(x=t.property_type)||void 0===x?void 0:x.toLowerCase())||"";break;default:return 0}return p<h?"asc"===O?-1:1:p>h?"asc"===O?1:-1:0}):[],[t,F,O]),U=e=>{F===e?I("asc"===O?"desc":"asc"):(M(e),I("asc"))},q=async e=>{if(confirm("Are you sure you want to delete this property?"))try{let t=await n.PropertiesService.delete(e);t.success?(f.ZP.success("Property deleted successfully"),R()):(console.error("Delete error:",t.error),f.ZP.error("Failed to delete property"))}catch(e){console.error("Error:",e),f.ZP.error("Error deleting property")}},z=async e=>{if(confirm("Are you sure you want to mark this property as vacant? This will end all active leases."))try{if(e.active_leases&&e.active_leases.length>0){let t=new Date;t.setDate(t.getDate()-1);let s=t.toISOString().split("T")[0];for(let t of e.active_leases)await n.LeasesService.update(t.id,{lease_end_date:s,status:"vacant"})}await n.PropertiesService.update(e.id,{status:"empty"}),f.ZP.success("Property marked as vacant successfully"),await R()}catch(e){console.error("Error marking property vacant:",e),f.ZP.error("Error marking property vacant")}},B=e=>{E(e),S(!0)},Y=e=>{switch(e){case"rented":return"bg-green-100 text-green-800";case"empty":default:return"bg-gray-100 text-gray-800";case"owner_finance":return"bg-blue-100 text-blue-800";case"lease_purchase":return"bg-purple-100 text-purple-800"}},$=e=>{switch(e){case"rented":return"Rented";case"empty":return"Empty";case"owner_finance":return"Owner Finance";case"lease_purchase":return"Lease Purchase";default:return e}};return b?(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,r.jsx)("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-blue-600"})}):(0,r.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,r.jsx)("header",{className:"bg-white shadow-sm border-b border-gray-200",children:(0,r.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,r.jsxs)("div",{className:"flex justify-between items-center py-6",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Properties"}),(0,r.jsx)("p",{className:"text-gray-600",children:"Manage your rental properties"})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,r.jsxs)("div",{className:"flex space-x-6",children:[(0,r.jsxs)("div",{className:"text-right",children:[(0,r.jsx)("p",{className:"text-sm text-gray-600",children:"Total Properties"}),(0,r.jsx)("p",{className:"text-2xl font-bold text-blue-600",children:t.length})]}),(0,r.jsxs)("div",{className:"text-right",children:[(0,r.jsx)("p",{className:"text-sm text-gray-600",children:"Rented"}),(0,r.jsx)("p",{className:"text-2xl font-bold text-green-600",children:t.filter(e=>"rented"===e.status).length})]}),(0,r.jsxs)("div",{className:"text-right",children:[(0,r.jsx)("p",{className:"text-sm text-gray-600",children:"Empty"}),(0,r.jsx)("p",{className:"text-2xl font-bold text-gray-600",children:t.filter(e=>"empty"===e.status).length})]})]}),(0,r.jsx)("div",{className:"flex space-x-3",children:(0,r.jsxs)("button",{onClick:()=>e.push("/properties/new"),className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 flex items-center transition-colors",children:[(0,r.jsx)(i.Z,{className:"w-4 h-4 mr-2"}),"Add Property"]})})]})]})})}),(0,r.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,r.jsx)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 mb-6",children:(0,r.jsx)("div",{className:"p-6",children:(0,r.jsxs)("div",{className:"flex items-center justify-between space-x-4",children:[(0,r.jsx)("div",{className:"flex-1",children:(0,r.jsxs)("div",{className:"flex space-x-4",children:[(0,r.jsxs)("div",{className:"relative flex-1",children:[(0,r.jsx)(c.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),(0,r.jsx)("input",{type:"text",placeholder:"Search properties...",value:v,onChange:e=>w(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),(0,r.jsxs)("select",{value:k,onChange:e=>P(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[(0,r.jsx)("option",{value:"all",children:"All Statuses"}),(0,r.jsx)("option",{value:"rented",children:"Rented"}),(0,r.jsx)("option",{value:"empty",children:"Empty"}),(0,r.jsx)("option",{value:"owner_finance",children:"Owner Finance"}),(0,r.jsx)("option",{value:"lease_purchase",children:"Lease Purchase"})]})]})}),(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)("button",{onClick:()=>A("list"),className:"p-2 rounded-lg border transition-colors ".concat("list"===T?"bg-blue-100 border-blue-300 text-blue-700":"bg-white border-gray-300 text-gray-600 hover:bg-gray-50"),children:(0,r.jsx)(o.Z,{className:"w-4 h-4"})}),(0,r.jsx)("button",{onClick:()=>A("map"),className:"p-2 rounded-lg border transition-colors ".concat("map"===T?"bg-blue-100 border-blue-300 text-blue-700":"bg-white border-gray-300 text-gray-600 hover:bg-gray-50"),children:(0,r.jsx)(d.Z,{className:"w-4 h-4"})})]})]})})}),(0,r.jsx)("div",{className:"mb-6",children:(0,r.jsx)(C,{properties:t,onPropertiesUpdated:R})}),"map"===T&&(0,r.jsx)("div",{className:"mb-6",children:(0,r.jsx)(_,{properties:G.filter(e=>!!(!v||e.name.toLowerCase().includes(v.toLowerCase())||e.address.toLowerCase().includes(v.toLowerCase()))&&("all"===k||e.status===k)),height:"500px"})}),0===G.filter(e=>!!(!v||e.name.toLowerCase().includes(v.toLowerCase())||e.address.toLowerCase().includes(v.toLowerCase()))&&("all"===k||e.status===k)).length?(0,r.jsx)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:(0,r.jsxs)("div",{className:"text-center py-12",children:[(0,r.jsx)(m.Z,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),(0,r.jsx)("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:v?"No properties found":"No properties yet"}),(0,r.jsx)("p",{className:"text-gray-600 mb-4",children:v?"Try adjusting your search terms":"Get started by adding your first property"}),!v&&(0,r.jsxs)("button",{onClick:()=>e.push("/properties/new"),className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 flex items-center mx-auto transition-colors",children:[(0,r.jsx)(i.Z,{className:"w-4 h-4 mr-2"}),"Add Property"]})]})}):(0,r.jsx)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:(0,r.jsx)("div",{className:"overflow-x-auto w-full",children:(0,r.jsxs)("table",{className:"w-full min-w-[1400px]",children:[(0,r.jsx)("thead",{className:"bg-gray-50 border-b border-gray-200",children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{className:"px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider min-w-[120px]",children:"Actions"}),(0,r.jsx)("th",{className:"px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider min-w-[200px] cursor-pointer hover:bg-gray-100 select-none",onClick:()=>U("name"),children:(0,r.jsxs)("div",{className:"flex items-center",children:["Property","name"===F&&(0,r.jsx)("span",{className:"ml-1 text-blue-600",children:"asc"===O?"↑":"↓"})]})}),(0,r.jsx)("th",{className:"px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider min-w-[80px] cursor-pointer hover:bg-gray-100 select-none",onClick:()=>U("address"),children:(0,r.jsxs)("div",{className:"flex items-center",children:["Location","address"===F&&(0,r.jsx)("span",{className:"ml-1 text-blue-600",children:"asc"===O?"↑":"↓"})]})}),(0,r.jsx)("th",{className:"px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider min-w-[150px] cursor-pointer hover:bg-gray-100 select-none",onClick:()=>U("type"),children:(0,r.jsxs)("div",{className:"flex items-center",children:["Type & Details","type"===F&&(0,r.jsx)("span",{className:"ml-1 text-blue-600",children:"asc"===O?"↑":"↓"})]})}),(0,r.jsx)("th",{className:"px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider min-w-[100px] cursor-pointer hover:bg-gray-100 select-none",onClick:()=>U("rent"),children:(0,r.jsxs)("div",{className:"flex items-center",children:["Rent","rent"===F&&(0,r.jsx)("span",{className:"ml-1 text-blue-600",children:"asc"===O?"↑":"↓"})]})}),(0,r.jsx)("th",{className:"px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider min-w-[120px] cursor-pointer hover:bg-gray-100 select-none",onClick:()=>U("premium"),children:(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)(u.Z,{className:"w-4 h-4 mr-1"}),"Insurance","premium"===F&&(0,r.jsx)("span",{className:"ml-1 text-blue-600",children:"asc"===O?"↑":"↓"})]})}),(0,r.jsx)("th",{className:"px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider min-w-[100px] cursor-pointer hover:bg-gray-100 select-none",onClick:()=>U("status"),children:(0,r.jsxs)("div",{className:"flex items-center",children:["Status","status"===F&&(0,r.jsx)("span",{className:"ml-1 text-blue-600",children:"asc"===O?"↑":"↓"})]})}),(0,r.jsx)("th",{className:"px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider min-w-[150px]",children:"Active Leases"})]})}),(0,r.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:G.filter(e=>!!(!v||e.name.toLowerCase().includes(v.toLowerCase())||e.address.toLowerCase().includes(v.toLowerCase()))&&("all"===k||e.status===k)).map(t=>{var s;return(0,r.jsxs)("tr",{className:"hover:bg-gray-50 cursor-pointer",onDoubleClick:()=>e.push("/properties/edit/?id=".concat(t.id)),title:"Double-click to edit property",children:[(0,r.jsx)("td",{className:"px-6 py-4",children:(0,r.jsxs)("div",{className:"flex items-center justify-end space-x-2",children:[(0,r.jsxs)("button",{onClick:()=>e.push("/properties/edit/?id=".concat(t.id)),className:"bg-gray-100 text-gray-700 px-3 py-2 rounded text-xs hover:bg-gray-200 flex items-center transition-colors",title:"Edit ".concat(t.name),children:[(0,r.jsx)(x.Z,{className:"w-3 h-3 mr-1"}),"Edit ",t.name]}),(0,r.jsxs)("button",{onClick:()=>B(t),className:"bg-blue-100 text-blue-700 px-3 py-2 rounded text-xs hover:bg-blue-200 flex items-center transition-colors",children:[(0,r.jsx)(p.Z,{className:"w-3 h-3 mr-1"}),"Link"]}),"rented"===t.status&&t.active_lease_count&&t.active_lease_count>0&&(0,r.jsxs)("button",{onClick:()=>z(t),className:"bg-orange-100 text-orange-200 flex items-center transition-colors",title:"Mark property as vacant and end lease",children:[(0,r.jsx)(m.Z,{className:"w-3 h-3 mr-1"}),"Vacant"]}),(0,r.jsx)("button",{onClick:()=>q(t.id),className:"bg-red-100 text-red-700 px-3 py-2 rounded text-xs hover:bg-red-200 flex items-center transition-colors",children:(0,r.jsx)(h.Z,{className:"w-3 h-3"})})]})}),(0,r.jsx)("td",{className:"px-6 py-4",children:(0,r.jsxs)("div",{className:"min-w-0",children:[(0,r.jsx)("div",{className:"text-sm font-medium text-gray-900 truncate",children:t.name}),(0,r.jsx)("div",{className:"text-sm text-gray-500 truncate",children:t.address})]})}),(0,r.jsx)("td",{className:"px-6 py-4",children:(0,r.jsxs)("div",{className:"flex items-center text-sm text-gray-900",children:[(0,r.jsx)(g.Z,{className:"w-4 h-4 mr-1 text-gray-400 flex-shrink-0"}),(0,r.jsxs)("span",{className:"truncate",children:[t.city,", ",t.state]})]})}),(0,r.jsxs)("td",{className:"px-6 py-4",children:[(0,r.jsx)("div",{className:"text-sm text-gray-900 capitalize",children:t.property_type||"N/A"}),(t.bedrooms||t.bathrooms)&&(0,r.jsxs)("div",{className:"text-sm text-gray-500",children:[t.bedrooms&&"".concat(t.bedrooms," bed"),t.bedrooms&&t.bathrooms&&" • ",t.bathrooms&&"".concat(t.bathrooms," bath")]}),t.square_feet&&(0,r.jsxs)("div",{className:"text-sm text-gray-500",children:[t.square_feet.toLocaleString()," sq ft"]})]}),(0,r.jsx)("td",{className:"px-6 py-4",children:t.monthly_rent?(0,r.jsx)("div",{className:"text-sm font-medium text-green-600",children:(()=>{let e=(0,Z.S6)(t.notes||void 0);return(0,Z.eP)(t.monthly_rent||0,e)})()}):(0,r.jsx)("div",{className:"text-sm text-gray-500",children:"N/A"})}),(0,r.jsx)("td",{className:"px-6 py-4",children:t.insurance_premium?(0,r.jsxs)("div",{className:"text-sm font-medium text-blue-600",children:["$",t.insurance_premium.toLocaleString(),"/year"]}):(0,r.jsx)("div",{className:"text-sm text-gray-500",children:"N/A"})}),(0,r.jsx)("td",{className:"px-6 py-4",children:(0,r.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(Y(t.status)),children:$(t.status)})}),(0,r.jsx)("td",{className:"px-6 py-4",children:t.active_lease_count&&t.active_lease_count>0?(0,r.jsx)("div",{className:"space-y-1",children:null===(s=t.active_leases)||void 0===s?void 0:s.map((e,t)=>(0,r.jsxs)("div",{className:"flex items-center text-sm text-gray-900",children:[(0,r.jsx)(y.Z,{className:"w-4 h-4 mr-1 text-gray-400 flex-shrink-0"}),(0,r.jsxs)("span",{className:"truncate",children:["$",e.rent.toLocaleString()," - ",new Date(e.lease_start_date).toLocaleDateString()," to ",new Date(e.lease_end_date).toLocaleDateString()]})]},e.id))}):(0,r.jsx)("div",{className:"text-sm text-gray-500",children:"No active leases"})})]},t.id)})})]})})})]}),L&&D&&(0,r.jsx)(N,{propertyId:D.id,propertyName:D.name,onClose:()=>{S(!1),E(null)},onSuccess:()=>{R()}})]})}},9369:function(e,t,s){"use strict";function r(e,t){if(!e||!t)return e||0;switch(t.toLowerCase().trim()){case"weekly":return 4.33*e;case"bi-weekly":case"biweekly":case"bi_weekly":return 2.17*e;default:return e}}function a(e){if(!e)return"monthly";let t=e.match(/Rent cadence:\s*(\w+)/i);return t?t[1]:"monthly"}function l(e,t){if(!e)return"$0";let s=(null==t?void 0:t.toLowerCase().trim())||"monthly";return"$".concat(e.toLocaleString(),"/").concat(s)}function n(e,t,s){let r;let a=new Date(e);switch(s.toLowerCase().trim()){case"weekly":r=new Date(a.getTime()+6048e5*t);break;case"bi-weekly":case"biweekly":case"bi_weekly":r=new Date(a.getTime()+12096e5*t);break;default:(r=new Date(a)).setMonth(r.getMonth()+t)}return r}function i(e,t){if(console.log("calculateTotalLatePayments: Starting calculation for",e.first_name,e.last_name),!e||!t||!e.lease_start_date||!(null==t?void 0:t.monthly_rent))return console.log("calculateTotalLatePayments: Missing required data - tenant:",!!e,"property:",!!t,"lease_start_date:",null==e?void 0:e.lease_start_date,"monthly_rent:",null==t?void 0:t.monthly_rent),{totalLateFees:0,totalOutstanding:0,totalDue:0,latePeriods:0,payPeriods:[]};try{let s=a(t.notes),r=t.monthly_rent;console.log("calculateTotalLatePayments: Cadence:",s,"Monthly rent:",r);let l=r;"weekly"===s?l=r/4.33:("bi-weekly"===s||"biweekly"===s||"bi_weekly"===s)&&(l=r/2.17),console.log("Tenant calculation - Cadence:",s,"Monthly rent:",r,"Period rent:",l);let i=function(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:12,r=[],a=new Date,l=0,i=n(e,0,t),c=0,o=3*s;for(;i<=a&&l<2*s&&c<o;)i=n(e,++l,t),c++;if(c>=o)return console.error("getLastExpectedPaymentDates: Safety limit reached, possible infinite loop detected"),[];l=Math.max(0,l-1);for(let i=Math.max(0,l-s+1);i<=l;i++){let s=n(e,i,t);s<=a&&r.push(s)}return r}(e.lease_start_date,s,12),c=0,o=0,d=0,m=i.map(t=>{let r=function(e,t,s,r){let a=function(e){switch(e.toLowerCase().trim()){case"weekly":return 10;case"bi-weekly":case"biweekly":case"bi_weekly":return 20;default:return 45}}(s),l=e.toISOString().split("T")[0];t&&Array.isArray(t)||(t=[]);let n=new Date(e);n.setDate(n.getDate()-2);let i=new Date(e);i.setDate(i.getDate()+5);let c=t.filter(e=>{let t=new Date(e.date);return t>=n&&t<=i&&"completed"===e.status}),o=c.reduce((e,t)=>e+t.amount,0),d=Math.max(0,r-o),m=new Date,u=0===c.length&&m>i;return(u&&console.log("LATE PERIOD:",{expectedDate:l,periodEnd:i.toISOString().split("T")[0],today:m.toISOString().split("T")[0],outstanding:d,lateFee:d>0?a:0}),u)?{isLate:!0,daysLate:Math.max(0,function(e,t){let s=new Date(e);return Math.ceil(Math.abs(new Date(t).getTime()-s.getTime())/864e5)}(i,m)),lateFees:d>0?a:0,totalPaid:o,outstanding:d}:{isLate:!1,daysLate:0,lateFees:0,totalPaid:o,outstanding:d}}(t,e.payment_history,s,l);return r.isLate&&(c+=r.lateFees,o+=r.outstanding,d++),{expectedDate:t,...r}}),u={totalLateFees:c,totalOutstanding:o,totalDue:c+o,latePeriods:d,payPeriods:m};return console.log("calculateTotalLatePayments: Final result for",e.first_name,e.last_name,":",u),u}catch(e){return console.error("Error calculating late payments:",e),{totalLateFees:0,totalOutstanding:0,totalDue:0,latePeriods:0,payPeriods:[]}}}function c(e,t){try{if(!e||!t)return console.log("isTenantLate: Missing tenant or property data"),!1;console.log("isTenantLate: Starting check for tenant",e.first_name,e.last_name),console.log("isTenantLate: Tenant lease_start_date:",e.lease_start_date),console.log("isTenantLate: Property monthly_rent:",t.monthly_rent);let s=i(e,t),r=s.totalDue>0;return console.log("isTenantLate: Result - Total due:",s.totalDue,"Is late:",r),r}catch(e){return console.error("Error checking if tenant is late:",e),!1}}s.d(t,{GN:function(){return r},S6:function(){return a},c1:function(){return i},eP:function(){return l},mq:function(){return c}})}},function(e){e.O(0,[334,134,598,286,293,528,744],function(){return e(e.s=8978)}),_N_E=e.O()}]);